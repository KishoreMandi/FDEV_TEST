[{"filePath":"D:\\Online-Exam-Website\\Frontend\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\App.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\api\\adminApi.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\api\\authApi.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\api\\axiosInstance.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\api\\departmentApi.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\api\\examApi.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\api\\leaderboardApi.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\api\\reportApi.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\api\\resultApi.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\components\\AdminHeader.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\components\\AdminSidebar.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\components\\CodingEnvironment.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'question.codingData.language' and 'question.codingData.starterCode'. Either include them or remove the dependency array. If 'setCode' needs the current value of 'question.codingData.starterCode', you can also switch to useReducer instead of useState and read 'question.codingData.starterCode' in the reducer.","line":109,"column":6,"nodeType":"ArrayExpression","endLine":109,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [question._id, initialData, question.codingData.starterCode, question.codingData.language]","fix":{"range":[3208,3235],"text":"[question._id, initialData, question.codingData.starterCode, question.codingData.language]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from \"react\";\nimport Editor from \"@monaco-editor/react\";\nimport { Play, CheckCircle, XCircle, Loader2, ChevronRight, ChevronDown, RotateCcw } from \"lucide-react\";\nimport axios from \"../api/axiosInstance\";\nimport toast from \"react-hot-toast\";\n\nconst LANGUAGES = [\n  { id: \"javascript\", name: \"JavaScript (Node.js)\" },\n  { id: \"python\", name: \"Python 3\" },\n  { id: \"java\", name: \"Java\" },\n  { id: \"cpp\", name: \"C++\" },\n  { id: \"c\", name: \"C\" },\n];\n\nconst STARTER_CODE = {\n  javascript: `// Read input from stdin\nconst fs = require('fs');\nconst input = fs.readFileSync(0, 'utf-8').trim();\n\n// Write your logic here\nconsole.log('Hello World');`,\n\n  python: `import sys\n\n# Read input from stdin\n# input_data = sys.stdin.read().strip()\n\ndef solve():\n    # Write your logic here\n    print(\"Hello World\")\n\nif __name__ == '__main__':\n    solve()`,\n\n  java: `import java.util.*;\nimport java.io.*;\n\npublic class Main {\n    public static void main(String[] args) {\n        Scanner sc = new Scanner(System.in);\n        // Write your logic here\n        System.out.println(\"Hello World\");\n        \n        sc.close();\n    }\n}`,\n\n  cpp: `#include <iostream>\n#include <string>\n#include <vector>\n#include <algorithm>\n\nusing namespace std;\n\nint main() {\n    // Write your logic here\n    cout << \"Hello World\" << endl;\n    \n    return 0;\n}`,\n\n  c: `#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n\nint main() {\n    // Write your logic here\n    printf(\"Hello World\");\n    \n    return 0;\n}`\n};\n\nconst CodingEnvironment = ({ question, initialData, onSave, layout = \"default\" }) => {\n  const [code, setCode] = useState(initialData?.code || question.codingData.starterCode || \"\");\n  const [language, setLanguage] = useState(initialData?.language || question.codingData.language);\n  const [isRunning, setIsRunning] = useState(false);\n  const [results, setResults] = useState(null);\n  const [isCustomMode, setIsCustomMode] = useState(false);\n  const [customInput, setCustomInput] = useState(\"\");\n  const [customOutput, setCustomOutput] = useState(null);\n  const editorRef = useRef(null);\n  // Ref to store code for each language to prevent data loss when switching\n  const codeMapRef = useRef({});\n\n  useEffect(() => {\n    // Initialize codeMap with initial data if available\n    if (initialData?.code && initialData?.language) {\n      codeMapRef.current[initialData.language] = initialData.code;\n    } else if (question.codingData.starterCode && question.codingData.language) {\n      codeMapRef.current[question.codingData.language] = question.codingData.starterCode;\n    }\n  }, [question, initialData]);\n\n  useEffect(() => {\n    // Update code if question changes and no saved code exists\n    if (!initialData?.code) {\n      setCode(question.codingData.starterCode || STARTER_CODE[question.codingData.language] || \"\");\n      setLanguage(question.codingData.language);\n      // Clear code map for new question\n      codeMapRef.current = {};\n      if (question.codingData.starterCode) {\n        codeMapRef.current[question.codingData.language] = question.codingData.starterCode;\n      }\n    } else {\n      setCode(initialData.code);\n      setLanguage(initialData.language);\n    }\n  }, [question._id, initialData]);\n\n  const handleLanguageChange = (e) => {\n    const newLang = e.target.value;\n    const oldLang = language;\n    \n    // Save current code to map\n    codeMapRef.current[oldLang] = code;\n    \n    setLanguage(newLang);\n    \n    // Load code for new language\n    if (codeMapRef.current[newLang]) {\n      setCode(codeMapRef.current[newLang]);\n    } else {\n      // If no saved code, use starter code\n      // If this is the question's original language, prefer admin starter code\n      if (newLang === question.codingData.language) {\n         setCode(question.codingData.starterCode || STARTER_CODE[newLang] || \"\");\n      } else {\n         setCode(STARTER_CODE[newLang] || \"\");\n      }\n    }\n  };\n\n  const handleResetCode = () => {\n    // If the selected language matches the question's original language, use the admin's starter code\n    if (language === question.codingData.language) {\n      setCode(question.codingData.starterCode || STARTER_CODE[language] || \"\");\n    } else {\n      // Otherwise, use the generic starter code for that language\n      setCode(STARTER_CODE[language] || \"\");\n    }\n    toast.success(\"Code reset to template\");\n  };\n\n  const handleRun = async (mode) => {\n    setIsRunning(true);\n    setResults(null);\n    setCustomOutput(null);\n\n    // If running custom input, ensure the panel is visible\n    if (mode === 'custom') {\n      setIsCustomMode(true);\n    } else {\n      setIsCustomMode(false);\n    }\n\n    try {\n      if (mode === 'custom') {\n        const res = await axios.post(\"/questions/execute-custom\", {\n          code,\n          language,\n          stdin: customInput\n        });\n        setCustomOutput(res.data);\n        toast.success(\"Custom execution complete\");\n      } else {\n        const res = await axios.post(\"/questions/execute\", {\n          questionId: question._id,\n          code,\n          language,\n        });\n        setResults(res.data);\n        if (res.data.allPassed) {\n          toast.success(\"All test cases passed!\");\n        } else {\n          toast.error(\"Some test cases failed.\");\n        }\n        \n        onSave({\n          code,\n          language,\n          isCorrect: res.data.allPassed,\n          testCases: res.data.results,\n        });\n      }\n    } catch (error) {\n      toast.error(\"Execution failed: \" + (error.response?.data?.message || error.message));\n    } finally {\n      setIsRunning(false);\n    }\n  };\n\n  const handleEditorMount = (editor) => {\n    editorRef.current = editor;\n    \n    // Disable Copy/Paste\n    editor.onKeyDown((e) => {\n      // Check for Ctrl+C, Ctrl+V, Cmd+C, Cmd+V\n      if ((e.ctrlKey || e.metaKey) && (e.code === \"KeyC\" || e.code === \"KeyV\")) {\n        e.preventDefault();\n        e.stopPropagation();\n        toast.error(\"Copy/Paste is disabled!\");\n      }\n    });\n\n    // Disable Context Menu (Right Click)\n    editor.onContextMenu((e) => {\n      e.event.preventDefault();\n      e.event.stopPropagation();\n    });\n  };\n\n  const isSplitVertical = layout === \"split-vertical\";\n\n  return (\n    <div className={`flex flex-col h-full bg-[#1e1e1e] ${!isSplitVertical ? 'rounded-xl shadow-2xl border border-gray-700' : ''} overflow-hidden`}>\n      {/* MNC Style Header */}\n      <div className=\"bg-[#252526] text-gray-300 p-2 px-4 flex justify-between items-center border-b border-[#3e3e3e] z-10 h-14\">\n        <div className=\"flex items-center gap-4\">\n          <div className=\"relative\">\n            <select \n              value={language}\n              onChange={handleLanguageChange}\n              className=\"appearance-none bg-[#3c3c3c] text-white px-4 py-1.5 pr-8 rounded border border-gray-600 focus:outline-none focus:border-blue-500 text-[16px] font-medium hover:bg-[#4c4c4c] transition-colors cursor-pointer\"\n            >\n              {LANGUAGES.map((lang) => (\n                <option key={lang.id} value={lang.id}>{lang.name}</option>\n              ))}\n            </select>\n            <ChevronDown size={14} className=\"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none\" />\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-4\">\n          <label className=\"flex items-center gap-2 cursor-pointer mr-2\">\n            <input \n              type=\"checkbox\" \n              checked={isCustomMode} \n              onChange={(e) => setIsCustomMode(e.target.checked)}\n              className=\"w-4 h-4 rounded border-gray-600 text-blue-600 focus:ring-blue-500 bg-[#3c3c3c]\"\n            />\n            <span className=\"text-xs font-medium text-gray-400 select-none\">Show Custom Input</span>\n          </label>\n\n          <div className=\"flex items-center gap-2\">\n            <button\n              onClick={handleResetCode}\n              disabled={isRunning}\n              className=\"flex items-center gap-2 bg-[#3c3c3c] hover:bg-[#4c4c4c] text-white px-3 py-1.5 rounded-md text-sm font-bold transition-all disabled:opacity-50 active:scale-95 shadow-md border border-gray-600\"\n              title=\"Reset Code\"\n              type=\"button\"\n            >\n              <RotateCcw size={14} />\n              Reset\n            </button>\n            <button\n              onClick={() => handleRun('custom')}\n              disabled={isRunning}\n              className=\"flex items-center gap-2 bg-[#3c3c3c] hover:bg-[#4c4c4c] text-white px-4 py-1.5 rounded-md text-sm font-bold transition-all disabled:opacity-50 active:scale-95 shadow-md border border-gray-600\"\n            >\n              {isRunning && isCustomMode ? <Loader2 className=\"animate-spin\" size={14} /> : <Play size={14} />}\n              Run Code\n            </button>\n\n            <button\n              onClick={() => handleRun('tests')}\n              disabled={isRunning}\n              className=\"flex items-center gap-2 bg-[#238636] hover:bg-[#2ea043] text-white px-4 py-1.5 rounded-md text-sm font-bold transition-all disabled:opacity-50 active:scale-95 shadow-md border border-[rgba(240,246,252,0.1)]\"\n            >\n              {isRunning && !isCustomMode ? <Loader2 className=\"animate-spin\" size={14} /> : <CheckCircle size={14} />}\n              Run Tests\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Main Layout Area */}\n      <div className={`flex flex-col flex-1 overflow-hidden relative`}>\n        {/* Editor Area */}\n        <div className=\"flex-1 relative border-b border-[#3e3e3e]\">\n          <Editor\n            height=\"100%\"\n            language={language === 'cpp' ? 'cpp' : language === 'c' ? 'c' : language}\n            theme=\"vs-dark\"\n            value={code}\n            onMount={handleEditorMount}\n            onChange={(value) => {\n              setCode(value);\n              onSave({ code: value, language, isCorrect: results?.allPassed || false });\n            }}\n            options={{\n              minimap: { enabled: false },\n              fontSize: 14,\n              automaticLayout: true,\n              mouseWheelZoom: false,\n              scrollBeyondLastLine: false,\n              padding: { top: 16, bottom: 16 },\n              fontFamily: \"'Fira Code', 'Cascadia Code', Consolas, monospace\",\n              fontLigatures: true,\n              cursorBlinking: \"smooth\",\n              smoothScrolling: true,\n              renderLineHighlight: \"line\",\n              contextmenu: false, // Disable right-click menu\n              quickSuggestions: true, // Enable IntelliSense\n              suggestOnTriggerCharacters: true,\n              wordBasedSuggestions: true,\n              parameterHints: { enabled: true },\n            }}\n          />\n        </div>\n\n        {/* Results Panel (Bottom) */}\n        <div className=\"h-1/3 bg-[#1e1e1e] flex flex-col border-t border-[#3e3e3e]\">\n          <div className=\"p-3 border-b border-[#3e3e3e] bg-[#252526] flex justify-between items-center px-6\">\n            <h3 className=\"font-bold text-gray-300 flex items-center gap-2 text-xs uppercase tracking-wider\">\n              {isCustomMode ? \"Custom Input / Output\" : \"Test Results\"}\n            </h3>\n            {!isCustomMode && results && (\n              <div className=\"flex gap-4\">\n                <span className=\"text-xs font-bold text-gray-400\">\n                  Passed: <span className=\"text-green-400\">{results.results.filter(r => r.passed).length}/{results.results.length}</span>\n                </span>\n              </div>\n            )}\n          </div>\n          \n          <div className=\"flex-1 overflow-y-auto p-4 pb-24 custom-scrollbar bg-[#1e1e1e]\">\n            {isCustomMode ? (\n              <div className=\"flex h-full gap-4\">\n                <div className=\"flex-1 flex flex-col gap-2\">\n                  <label className=\"text-xs font-bold text-gray-500 uppercase\">Input</label>\n                  <textarea\n                    value={customInput}\n                    onChange={(e) => setCustomInput(e.target.value)}\n                    className=\"flex-1 bg-[#2d2d2d] text-gray-300 p-3 rounded-lg border border-[#3e3e3e] focus:outline-none focus:border-blue-500 font-mono text-[16px] resize-none\"\n                    placeholder=\"Enter custom input here...\"\n                  />\n                </div>\n                <div className=\"flex-1 flex flex-col gap-2\">\n                  <label className=\"text-xs font-bold text-gray-500 uppercase\">Output</label>\n                  <div className=\"flex-1 bg-[#2d2d2d] text-gray-300 p-3 rounded-lg border border-[#3e3e3e] font-mono text-sm overflow-auto whitespace-pre-wrap\">\n                    {customOutput ? (\n                      <>\n                        {customOutput.output}\n                        {customOutput.stderr && <div className=\"text-red-400 mt-2 pt-2 border-t border-red-900/30\">Error: {customOutput.stderr}</div>}\n                      </>\n                    ) : (\n                      <span className=\"text-gray-600 italic\">Run code to see output...</span>\n                    )}\n                  </div>\n                </div>\n              </div>\n            ) : (\n              <>\n            {!results && !isRunning && (\n              <div className=\"flex flex-col items-center justify-center h-full text-gray-500 opacity-60\">\n                <div className=\"bg-[#2d2d2d] p-3 rounded-full mb-3\">\n                    <Play size={24} className=\"text-gray-400 ml-1\" />\n                </div>\n                <p className=\"text-xs font-medium uppercase tracking-widest\">Run code to view output</p>\n              </div>\n            )}\n\n            {isRunning && (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                {[1, 2, 3].map((i) => (\n                  <div key={i} className=\"animate-pulse bg-[#2d2d2d] p-4 rounded-lg border border-[#3e3e3e] h-24\">\n                    <div className=\"h-3 bg-[#3e3e3e] rounded w-1/3 mb-4\"></div>\n                    <div className=\"h-8 bg-[#3e3e3e] rounded\"></div>\n                  </div>\n                ))}\n              </div>\n            )}\n\n            {results && (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 animate-in fade-in slide-in-from-bottom-2 duration-300\">\n                {results.results.map((res, idx) => (\n                  <div\n                    key={idx}\n                    className={`bg-[#2d2d2d] rounded-lg border shadow-sm overflow-hidden transition-all flex flex-col ${\n                      res.passed ? \"border-green-900/50\" : \"border-red-900/50\"\n                    }`}\n                  >\n                    <div className={`px-4 py-2 flex justify-between items-center border-b ${\n                      res.passed ? \"bg-green-900/20 border-green-900/30\" : \"bg-red-900/20 border-red-900/30\"\n                    }`}>\n                      <span className=\"text-[10px] font-black text-gray-400 uppercase tracking-widest\">\n                        Case {idx + 1}\n                      </span>\n                      {res.passed ? (\n                        <div className=\"flex items-center gap-1 text-green-400 font-black text-[10px]\">\n                          <CheckCircle size={12} /> PASSED\n                        </div>\n                      ) : (\n                        <div className=\"flex items-center gap-1 text-red-400 font-black text-[10px]\">\n                          <XCircle size={12} /> FAILED\n                        </div>\n                      )}\n                    </div>\n                    \n                    <div className=\"p-3 flex-1 space-y-2 overflow-y-auto custom-scrollbar-sm max-h-40\">\n                      {res.input !== \"Hidden\" ? (\n                        <>\n                          <div className=\"space-y-1\">\n                            <label className=\"text-[9px] font-black text-gray-500 uppercase tracking-tighter\">Input</label>\n                            <pre className=\"bg-[#1e1e1e] p-1.5 rounded text-[11px] font-mono text-gray-300 border border-[#3e3e3e]\">{res.input || \"(empty)\"}</pre>\n                          </div>\n                          <div className=\"grid grid-cols-2 gap-2\">\n                            <div className=\"space-y-1\">\n                              <label className=\"text-[9px] font-black text-gray-500 uppercase tracking-tighter\">Expected</label>\n                              <pre className=\"bg-[#1e1e1e] p-1.5 rounded text-[11px] font-mono text-gray-300 border border-[#3e3e3e]\">{res.expectedOutput}</pre>\n                            </div>\n                            <div className=\"space-y-1\">\n                              <label className=\"text-[9px] font-black text-gray-500 uppercase tracking-tighter\">Actual</label>\n                              <pre className={`p-1.5 rounded text-[11px] font-mono border ${\n                                res.passed ? \"bg-green-900/10 text-green-300 border-green-900/30\" : \"bg-red-900/10 text-red-300 border-red-900/30\"\n                              }`}>\n                                {res.actualOutput || (res.error ? \"Error\" : \"(empty)\")}\n                              </pre>\n                            </div>\n                          </div>\n                        </>\n                      ) : (\n                        <div className=\"py-2 text-center\">\n                          <p className=\"text-[11px] font-bold text-gray-500 italic\">\n                            Security Hidden\n                          </p>\n                          <div className={`mt-1 inline-flex items-center px-2 py-0.5 rounded-full text-[9px] font-black uppercase ${\n                            res.passed ? \"bg-green-900/20 text-green-400\" : \"bg-red-900/20 text-red-400\"\n                          }`}>\n                            {res.passed ? \"Passed\" : \"Failed\"}\n                          </div>\n                        </div>\n                      )}\n\n                      {res.error && (\n                        <div className=\"space-y-1\">\n                          <label className=\"text-[9px] font-black text-red-400 uppercase tracking-tighter\">Error</label>\n                          <pre className=\"bg-red-900/10 text-red-300 p-1.5 rounded text-[10px] font-mono border border-red-900/30 whitespace-pre-wrap\">\n                            {res.error}\n                          </pre>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n            </>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default CodingEnvironment;\n","usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\components\\CsvUploader.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\components\\ErrorBoundary.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\components\\Leaderboard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\components\\LogoutButton.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\components\\QuestionCard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\components\\QuestionPalette.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\components\\StatCard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\components\\SubmitModal.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\components\\SystemCheckModal.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'stopStream'. Either include it or remove the dependency array.","line":74,"column":6,"nodeType":"ArrayExpression","endLine":74,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [open, stopStream]","fix":{"range":[2136,2142],"text":"[open, stopStream]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useRef, useState } from \"react\";\nimport { X, Camera, Mic, AlertCircle, CheckCircle, User as UserIcon } from \"lucide-react\";\nimport toast from \"react-hot-toast\";\n\nconst SystemCheckModal = ({ open, onClose, onConfirm }) => {\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const [stream, setStream] = useState(null);\n  const [checks, setChecks] = useState({\n    camera: false,\n    mic: false,\n    personDetected: false,\n    permission: \"pending\", // pending, granted, denied\n  });\n  const [error, setError] = useState(\"\");\n  const [videoSignalMsg, setVideoSignalMsg] = useState(\"\");\n\n  function stopStream() {\n    if (stream) {\n      stream.getTracks().forEach((track) => track.stop());\n      setStream(null);\n    }\n    setChecks({ camera: false, mic: false, personDetected: false, permission: \"pending\" });\n    setError(\"\");\n    setVideoSignalMsg(\"\");\n  }\n\n  async function startSystemCheck() {\n    try {\n      const mediaStream = await navigator.mediaDevices.getUserMedia({\n        video: true,\n        audio: true,\n      });\n\n      setStream(mediaStream);\n\n      const videoTrack = mediaStream.getVideoTracks()[0];\n      const audioTrack = mediaStream.getAudioTracks()[0];\n\n      if (videoTrack && videoTrack.readyState === \"live\") {\n        setChecks((prev) => ({ ...prev, camera: true }));\n      }\n      if (audioTrack && audioTrack.readyState === \"live\") {\n        setChecks((prev) => ({ ...prev, mic: true }));\n      }\n\n      setChecks((prev) => ({ ...prev, permission: \"granted\" }));\n    } catch (err) {\n      console.error(\"System check failed\", err);\n      setChecks((prev) => ({ ...prev, permission: \"denied\" }));\n      setError(\n        \"Could not access Camera or Microphone. Please allow permissions to proceed.\"\n      );\n      toast.error(\"System check failed!\");\n    }\n  }\n\n  useEffect(() => {\n    let timeoutId;\n    if (open) {\n      timeoutId = setTimeout(() => {\n        startSystemCheck();\n      }, 0);\n    } else {\n      timeoutId = setTimeout(() => {\n        stopStream();\n      }, 0);\n    }\n\n    return () => {\n      clearTimeout(timeoutId);\n      stopStream();\n    };\n  }, [open]);\n\n  useEffect(() => {\n    if (videoRef.current && stream) {\n      videoRef.current.srcObject = stream;\n      videoRef.current.play().catch(e => console.error(\"Error playing video stream:\", e));\n    }\n  }, [stream]);\n\n  // Video Signal & Person Detection Logic\n  useEffect(() => {\n    let interval;\n    if (stream && videoRef.current) {\n      interval = setInterval(() => {\n        const video = videoRef.current;\n        const canvas = canvasRef.current;\n        if (video.readyState === 4 && canvas) {\n          try {\n            const ctx = canvas.getContext(\"2d\", { willReadFrequently: true });\n            canvas.width = 100;\n            canvas.height = 100;\n            ctx.drawImage(video, 0, 0, 100, 100);\n            const imageData = ctx.getImageData(0, 0, 100, 100).data;\n            \n            let totalBrightness = 0;\n            for (let i = 0; i < imageData.length; i += 4) {\n              totalBrightness += (imageData[i] + imageData[i + 1] + imageData[i + 2]) / 3;\n            }\n            const avgBrightness = totalBrightness / (imageData.length / 4);\n            \n            if (avgBrightness < 15) {\n              setChecks(prev => ({ ...prev, personDetected: false }));\n              setVideoSignalMsg(\"Camera is too dark or covered. Please adjust lighting.\");\n            } else {\n              setChecks(prev => ({ ...prev, personDetected: true }));\n              setVideoSignalMsg(\"\");\n            }\n          } catch (err) {\n            console.error(\"Video analysis error:\", err);\n          }\n        }\n      }, 1000);\n    }\n    return () => clearInterval(interval);\n  }, [stream]);\n\n  if (!open) return null;\n\n  const allPassed = checks.camera && checks.mic && checks.personDetected;\n\n  return (\n    <div className=\"fixed inset-0 bg-black/80 flex items-center justify-center z-50\">\n      <div className=\"bg-white w-[90%] max-w-lg rounded-xl p-6 relative shadow-2xl\">\n        <canvas ref={canvasRef} className=\"hidden\" />\n        <button\n          onClick={onClose}\n          className=\"absolute top-4 right-4 text-gray-500 hover:text-gray-700\"\n        >\n          <X size={24} />\n        </button>\n\n        <h2 className=\"text-2xl font-bold mb-6 text-gray-800\">System Verification</h2>\n\n        <div className=\"space-y-6\">\n          {/* Video Preview */}\n          <div className=\"relative bg-black rounded-lg overflow-hidden aspect-video flex items-center justify-center\">\n            {stream ? (\n              <video\n                ref={videoRef}\n                autoPlay\n                muted\n                playsInline\n                className=\"w-full h-full object-cover transform scale-x-[-1]\" // Mirror effect\n              />\n            ) : (\n              <div className=\"text-gray-400 flex flex-col items-center\">\n                <Camera size={48} className=\"mb-2\" />\n                <p>Camera is off</p>\n              </div>\n            )}\n            \n            {/* Status Overlay */}\n            <div className=\"absolute top-2 left-2 bg-black/60 text-white px-3 py-1 rounded-full text-xs flex items-center gap-2\">\n               <span className={`w-2 h-2 rounded-full ${checks.camera && checks.personDetected ? 'bg-green-500' : 'bg-red-500'}`}></span>\n               {checks.camera && checks.personDetected ? \"Camera Active\" : \"Camera Issue\"}\n            </div>\n          </div>\n\n          {/* Status List */}\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n             <div className={`p-4 rounded-lg border flex items-center gap-3 ${checks.camera ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'}`}>\n                <Camera className={checks.camera ? \"text-green-600\" : \"text-red-500\"} />\n                <div>\n                   <p className=\"font-semibold text-sm\">Camera</p>\n                   <p className=\"text-xs text-gray-500\">{checks.camera ? \"Detected & Working\" : \"Not Detected\"}</p>\n                </div>\n                {checks.camera ? <CheckCircle size={18} className=\"text-green-600 ml-auto\" /> : <AlertCircle size={18} className=\"text-red-500 ml-auto\" />}\n             </div>\n\n             <div className={`p-4 rounded-lg border flex items-center gap-3 ${checks.mic ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'}`}>\n                <Mic className={checks.mic ? \"text-green-600\" : \"text-red-500\"} />\n                <div>\n                   <p className=\"font-semibold text-sm\">Microphone</p>\n                   <p className=\"text-xs text-gray-500\">{checks.mic ? \"Detected & Working\" : \"Not Detected\"}</p>\n                </div>\n                {checks.mic ? <CheckCircle size={18} className=\"text-green-600 ml-auto\" /> : <AlertCircle size={18} className=\"text-red-500 ml-auto\" />}\n             </div>\n\n             <div className={`p-4 rounded-lg border flex items-center gap-3 col-span-1 sm:col-span-2 ${checks.personDetected ? 'bg-green-50 border-green-200' : 'bg-amber-50 border-amber-200'}`}>\n                <UserIcon className={checks.personDetected ? \"text-green-600\" : \"text-amber-500\"} />\n                <div>\n                   <p className=\"font-semibold text-sm\">Person Detection</p>\n                   <p className=\"text-xs text-gray-500\">{checks.personDetected ? \"Person Detected\" : (videoSignalMsg || \"Adjusting...\")}</p>\n                </div>\n                {checks.personDetected ? <CheckCircle size={18} className=\"text-green-600 ml-auto\" /> : <AlertCircle size={18} className=\"text-amber-500 ml-auto\" />}\n             </div>\n          </div>\n\n          {error && (\n            <div className=\"bg-red-100 text-red-700 p-3 rounded text-sm flex items-center gap-2\">\n              <AlertCircle size={16} />\n              {error}\n              <button \n                onClick={() => { setError(\"\"); startSystemCheck(); }}\n                className=\"ml-auto text-xs bg-white px-2 py-1 rounded border border-red-200 hover:bg-gray-50\"\n              >\n                Retry\n              </button>\n            </div>\n          )}\n\n          {!allPassed && !error && (\n             <button \n               onClick={startSystemCheck}\n               className=\"w-full py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium text-gray-700\"\n             >\n               Refresh Camera / Retry Check\n             </button>\n          )}\n\n          <div className=\"text-sm text-gray-500 bg-blue-50 p-3 rounded\">\n             <p><b>Note:</b> You must keep your camera and microphone ON during the entire exam. Turning them off will result in automatic submission.</p>\n          </div>\n        </div>\n\n        <div className=\"flex justify-end gap-3 mt-6\">\n          <button\n            onClick={onClose}\n            className=\"px-5 py-2.5 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition\"\n          >\n            Cancel\n          </button>\n          <button\n            onClick={onConfirm}\n            disabled={!allPassed}\n            className={`px-5 py-2.5 rounded-lg text-white font-medium transition flex items-center gap-2 ${\n              allPassed\n                ? \"bg-blue-600 hover:bg-blue-700 shadow-lg\"\n                : \"bg-gray-400 cursor-not-allowed\"\n            }`}\n          >\n            Start Exam\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default SystemCheckModal;\n","usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\components\\Timer.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'onTimeUp'. Either include it or remove the dependency array. If 'onTimeUp' changes too often, find the parent component that defines it and wrap that definition in useCallback.","line":24,"column":6,"nodeType":"ArrayExpression","endLine":24,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [onTimeUp]","fix":{"range":[642,644],"text":"[onTimeUp]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from \"react\";\r\n\r\nconst Timer = ({ initialSeconds, onTimeUp }) => {\r\n  const [timeLeft, setTimeLeft] = useState(initialSeconds);\r\n\r\n  useEffect(() => {\r\n    // Sync local state if prop changes drastically (optional, but good for resume)\r\n    setTimeLeft(initialSeconds);\r\n  }, [initialSeconds]);\r\n\r\n  useEffect(() => {\r\n    const interval = setInterval(() => {\r\n      setTimeLeft((prev) => {\r\n        if (prev <= 1) {\r\n          clearInterval(interval);\r\n          onTimeUp();\r\n          return 0;\r\n        }\r\n        return prev - 1;\r\n      });\r\n    }, 1000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n  const minutes = Math.floor(timeLeft / 60);\r\n  const seconds = timeLeft % 60;\r\n\r\n  return (\r\n    <div\r\n      className={`px-4 py-2 rounded text-white font-semibold ${\r\n        timeLeft < 300 ? \"bg-red-600\" : \"bg-green-600\"\r\n      }`}\r\n    >\r\n      ‚è± {minutes}:{seconds.toString().padStart(2, \"0\")}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Timer;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\context\\AuthContext.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\context\\auth.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\main.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\pages\\admin\\AddQuestions.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchQuestions'. Either include it or remove the dependency array.","line":68,"column":6,"nodeType":"ArrayExpression","endLine":68,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [examId, exams, fetchQuestions]","fix":{"range":[2298,2313],"text":"[examId, exams, fetchQuestions]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState, useRef } from \"react\";\nimport toast from \"react-hot-toast\";\nimport { Folder, ArrowLeft, Download, Code, List, Plus, Trash2, Maximize2, Minimize2 } from \"lucide-react\";\nimport jsPDF from \"jspdf\";\nimport autoTable from \"jspdf-autotable\";\nimport Editor from \"@monaco-editor/react\";\n\nimport AdminSidebar from \"../../components/AdminSidebar\";\nimport AdminHeader from \"../../components/AdminHeader\";\nimport { getExams, getAdminQuestions, deleteQuestion } from \"../../api/examApi\";\nimport axios from \"../../api/axiosInstance\";\n\nconst AddQuestions = () => {\n  const [exams, setExams] = useState([]);\n  const [examId, setExamId] = useState(\"\");\n  const [questionsList, setQuestionsList] = useState([]);\n  const [editingId, setEditingId] = useState(null);\n\n  const [type, setType] = useState(\"mcq\"); // mcq or coding\n  const [question, setQuestion] = useState(\"\");\n  const [options, setOptions] = useState([\"\", \"\", \"\", \"\"]);\n  const [correctOption, setCorrectOption] = useState(null);\n  \n  // Coding states\n  const [language, setLanguage] = useState(\"javascript\");\n  const [starterCode, setStarterCode] = useState(\"\");\n  const [testCases, setTestCases] = useState([{ input: \"\", expectedOutput: \"\", isHidden: false }]);\n\n  const [isPublished, setIsPublished] = useState(false);\n  const [isFullscreen, setIsFullscreen] = useState(false);\n\n  // Undo history for smart paste\n  const undoRef = useRef(null);\n  const isSmartPasting = useRef(false);\n\n  useEffect(() => {\n    getExams().then((res) => setExams(res.data));\n  }, []);\n\n  async function fetchQuestions() {\n    try {\n      const res = await getAdminQuestions(examId);\n      setQuestionsList(res.data);\n    } catch (error) {\n      console.error(\"Failed to fetch questions\", error);\n    }\n  }\n\n  useEffect(() => {\n    const timeoutId = setTimeout(() => {\n      if (examId) {\n        const selectedExam = exams.find((e) => e._id === examId);\n        const published = Boolean(selectedExam?.isPublished);\n\n        setIsPublished(published);\n        if (published) {\n          toast.error(\"Your exam is already published, unable to add questions\");\n        }\n\n        fetchQuestions();\n      } else {\n        setQuestionsList([]);\n        setIsPublished(false);\n      }\n    }, 0);\n\n    return () => clearTimeout(timeoutId);\n  }, [examId, exams]);\n\n  const handleOptionChange = (value, index) => {\n    // Clear undo history if user manually edits options\n    undoRef.current = null;\n    const updated = [...options];\n    updated[index] = value;\n    setOptions(updated);\n  };\n\n  const handleEdit = (q) => {\n    if (isPublished) {\n      toast.error(\"Your exam is already published, unable to edit questions\");\n      return;\n    }\n    setEditingId(q._id);\n    setType(q.type || \"mcq\");\n    setQuestion(q.question);\n    if (q.type === \"coding\") {\n      setLanguage(q.codingData.language);\n      setStarterCode(q.codingData.starterCode);\n      setTestCases(q.codingData.testCases);\n    } else {\n      setOptions(q.options);\n      setCorrectOption(q.correctOption);\n    }\n    window.scrollTo(0, 0);\n  };\n\n  const handleCancelEdit = () => {\n    setEditingId(null);\n    setQuestion(\"\");\n    setOptions([\"\", \"\", \"\", \"\"]);\n    setCorrectOption(null);\n    setType(\"mcq\");\n    setStarterCode(\"\");\n    setTestCases([{ input: \"\", expectedOutput: \"\", isHidden: false }]);\n  };\n\n  const handleDelete = async (id) => {\n    if (isPublished) {\n      toast.error(\"Your exam is already published, unable to delete questions\");\n      return;\n    }\n    if (!window.confirm(\"Are you sure you want to delete this question?\")) return;\n    try {\n      await deleteQuestion(id);\n      toast.success(\"Question deleted\");\n      fetchQuestions();\n    } catch {\n      toast.error(\"Failed to delete question\");\n    }\n  };\n\n  const handleDownloadQuestions = () => {\n    if (questionsList.length === 0) {\n      toast.error(\"No questions to download\");\n      return;\n    }\n\n    const examTitle = exams.find(e => e._id === examId)?.title || \"Exam\";\n    const doc = new jsPDF();\n\n    // Add Title\n    doc.setFontSize(18);\n    doc.text(`${examTitle} - Questions`, 14, 22);\n\n    // Prepare Table Data\n    const tableData = questionsList.map((q, index) => {\n      if (q.type === \"mcq\") {\n        return [\n          index + 1,\n          q.question,\n          \"MCQ\",\n          q.options[0],\n          q.options[1],\n          q.options[2],\n          q.options[3],\n          q.options[q.correctOption]\n        ];\n      } else {\n        return [\n          index + 1,\n          q.question,\n          \"CODING\",\n          \"-\",\n          \"-\",\n          \"-\",\n          \"-\",\n          `Lang: ${q.codingData?.language}`\n        ];\n      }\n    });\n\n    // Generate Table\n    autoTable(doc, {\n      startY: 30,\n      head: [[\"#\", \"Question\", \"Type\", \"Opt A\", \"Opt B\", \"Opt C\", \"Opt D\", \"Correct/Lang\"]],\n      body: tableData,\n      theme: \"grid\",\n      headStyles: { fillColor: [41, 128, 185] }, // Blue header\n      styles: { fontSize: 10, cellPadding: 3 },\n      columnStyles: {\n        0: { cellWidth: 10 }, // #\n        1: { cellWidth: 40 }, // Question\n        2: { cellWidth: 20 }, // Type\n        3: { cellWidth: 20 }, // Opt A\n        4: { cellWidth: 20 }, // Opt B\n        5: { cellWidth: 20 }, // Opt C\n        6: { cellWidth: 20 }, // Opt D\n        7: { cellWidth: 30 }, // Correct\n      },\n    });\n\n    doc.save(`${examTitle}_Questions.pdf`);\n  };\n\n  const handlePaste = (e) => {\n    const pastedData = e.clipboardData.getData(\"text\");\n    if (!pastedData) return;\n\n    const lines = pastedData.split(/\\r?\\n/).map(line => line.trim()).filter(line => line.length > 0);\n\n    if (lines.length >= 5) {\n      const last4 = lines.slice(-4);\n      const optionRegex = /^([A-Da-d1-4])[.)-]\\s+(.*)$/;\n      \n      const cleanedOptions = last4.map(opt => {\n        const match = opt.match(optionRegex);\n        return match ? match[2] : opt;\n      });\n\n      e.preventDefault();\n      \n      // Save current state for undo\n      undoRef.current = {\n        question: question, // Current question text before paste\n        options: [...options] // Current options before paste\n      };\n      \n      isSmartPasting.current = true;\n\n      const questionBody = lines.slice(0, lines.length - 4).join(\"\\n\");\n      \n      // Use execCommand to preserve browser undo history for the text field\n      setOptions(cleanedOptions);\n      \n      // Select all text in the textarea to ensure we replace content like a normal paste/set\n      e.target.select();\n      document.execCommand('insertText', false, questionBody);\n      \n      toast.success(\"Question and options auto-populated!\");\n    }\n  };\n\n  const handleKeyDown = (e) => {\n    // Custom Undo for Smart Paste (Ctrl+Z)\n    if ((e.ctrlKey || e.metaKey) && e.key === 'z') {\n      if (undoRef.current) {\n        e.preventDefault(); // Prevent native undo since we are handling it manually\n        \n        setQuestion(undoRef.current.question);\n        setOptions(undoRef.current.options);\n        \n        undoRef.current = null; // Clear undo history after using it\n        toast.success(\"Undid smart paste\");\n      }\n    }\n  };\n\n  const handleQuestionChange = (e) => {\n    setQuestion(e.target.value);\n    \n    // If this change was triggered by our smart paste, reset the flag but keep undo history\n    if (isSmartPasting.current) {\n      isSmartPasting.current = false;\n    } else {\n      // If user manually types/changes text, clear the smart paste undo history\n      undoRef.current = null;\n    }\n  };\n\n  const handleAddTestCase = () => {\n    setTestCases([...testCases, { input: \"\", expectedOutput: \"\", isHidden: false }]);\n  };\n\n  const handleRemoveTestCase = (index) => {\n    setTestCases(testCases.filter((_, i) => i !== index));\n  };\n\n  const handleTestCaseChange = (index, field, value) => {\n    const updated = [...testCases];\n    updated[index][field] = value;\n    setTestCases(updated);\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n\n    if (isPublished) {\n      toast.error(\"Your exam is already published, unable to add questions\");\n      return;\n    }\n\n    if (!examId) {\n      toast.error(\"Please select an exam\");\n      return;\n    }\n\n    if (type === \"mcq\" && correctOption === null) {\n      toast.error(\"Please select a correct option\");\n      return;\n    }\n\n    const payload = {\n      examId,\n      question,\n      type,\n      ...(type === \"mcq\"\n        ? { options, correctOption }\n        : {\n            codingData: {\n              language,\n              starterCode,\n              testCases,\n            },\n          }),\n    };\n\n    try {\n      if (editingId) {\n        await axios.put(`/questions/${editingId}`, payload);\n        toast.success(\"Question updated successfully\");\n        setEditingId(null);\n      } else {\n        await axios.post(\"/questions\", payload);\n        toast.success(\"Question added successfully\");\n      }\n\n      setQuestion(\"\");\n      setOptions([\"\", \"\", \"\", \"\"]);\n      setCorrectOption(null);\n      setStarterCode(\"\");\n      setTestCases([{ input: \"\", expectedOutput: \"\", isHidden: false }]);\n      fetchQuestions();\n    } catch (error) {\n      toast.error(error.response?.data?.message || \"Failed to save question\");\n    }\n  };\n\n  return (\n    <div className={`flex ${isFullscreen ? \"w-full h-screen\" : \"\"}`}>\n      {!isFullscreen && <AdminSidebar />}\n\n      <div className={`${isFullscreen ? \"w-full\" : \"ml-64 w-full\"} min-h-screen bg-gray-100`}>\n        {!isFullscreen && <AdminHeader />}\n\n        <div className=\"p-6 max-w-5xl mx-auto\">\n          {!examId ? (\n            // Folder View\n            <div>\n              <div className=\"flex items-center gap-4 mb-6\">\n                <button\n                  onClick={() => window.history.back()}\n                  className=\"p-2 hover:bg-gray-200 rounded-full transition text-gray-600\"\n                >\n                  <ArrowLeft size={24} />\n                </button>\n                <h2 className=\"text-2xl font-bold text-gray-800\">Select Exam Folder</h2>\n              </div>\n              {exams.length === 0 ? (\n                <p className=\"text-gray-500\">No exams found. Please create an exam first.</p>\n              ) : (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                  {exams.map((exam) => (\n                    <div \n                      key={exam._id} \n                      onClick={() => setExamId(exam._id)}\n                      className=\"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow cursor-pointer flex flex-col items-center justify-center border border-gray-200 group\"\n                    >\n                      <Folder size={64} className=\"text-blue-500 mb-4 group-hover:scale-110 transition-transform\" />\n                      <h3 className=\"text-lg font-semibold text-gray-800 text-center\">{exam.title}</h3>\n                      <p className=\"text-sm text-gray-500 mt-2\">Click to manage questions</p>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n          ) : (\n            // Question Management View\n            <div>\n              <div className=\"flex items-center justify-between mb-6\">\n                <button \n                  onClick={() => setExamId(\"\")}\n                  className=\"flex items-center text-gray-600 hover:text-blue-600 transition-colors\"\n                >\n                  <ArrowLeft size={20} className=\"mr-2\" />\n                  Back to Exams\n                </button>\n                <div className=\"flex items-center gap-4\">\n                  <h2 className=\"text-2xl font-bold text-gray-800\">\n                    {exams.find(e => e._id === examId)?.title} - Questions\n                  </h2>\n                  <button\n                    onClick={handleDownloadQuestions}\n                    className=\"flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors shadow-sm\"\n                    title=\"Download Questions\"\n                  >\n                    <Download size={18} />\n                    Download\n                  </button>\n                </div>\n              </div>\n\n              <div className={`grid ${isFullscreen ? \"grid-cols-1\" : \"grid-cols-1 lg:grid-cols-3\"} gap-8`}>\n                {/* Form Section */}\n                <div className={`${isFullscreen ? \"col-span-1\" : \"lg:col-span-1\"}`}>\n                  <div className={`bg-white p-6 rounded-xl shadow sticky top-6 ${isPublished ? \"opacity-75\" : \"\"} ${isFullscreen ? \"relative\" : \"\"}`}>\n                    <div className=\"flex justify-between items-center mb-4 border-b pb-2\">\n                      <h3 className=\"text-xl font-bold\">\n                        {editingId ? \"Edit Question\" : \"Add New Question\"}\n                      </h3>\n                      <button\n                        type=\"button\"\n                        onClick={() => setIsFullscreen(!isFullscreen)}\n                        className=\"text-gray-500 hover:text-gray-700\"\n                        title={isFullscreen ? \"Exit Fullscreen\" : \"Enter Fullscreen\"}\n                      >\n                        {isFullscreen ? <Minimize2 size={20} /> : <Maximize2 size={20} />}\n                      </button>\n                    </div>\n                    \n                    {isPublished && (\n                      <div className=\"bg-yellow-50 border-l-4 border-yellow-500 text-yellow-700 p-3 mb-4 text-sm\" role=\"alert\">\n                        <p className=\"font-bold\">Exam Published</p>\n                        <p>Questions cannot be modified.</p>\n                      </div>\n                    )}\n\n                    <form onSubmit={handleSubmit} className={`space-y-4 ${isPublished ? \"pointer-events-none\" : \"\"}`}>\n                      {/* Type Toggle */}\n                      <div className=\"flex gap-2 p-1 bg-gray-100 rounded-lg\">\n                        <button\n                          type=\"button\"\n                          onClick={() => setType(\"mcq\")}\n                          className={`flex-1 flex items-center justify-center gap-2 py-2 rounded-md transition-all ${type === \"mcq\" ? \"bg-white shadow-sm text-blue-600 font-bold\" : \"text-gray-500 hover:text-gray-700\"}`}\n                        >\n                          <List size={18} />\n                          MCQ\n                        </button>\n                        <button\n                          type=\"button\"\n                          onClick={() => setType(\"coding\")}\n                          className={`flex-1 flex items-center justify-center gap-2 py-2 rounded-md transition-all ${type === \"coding\" ? \"bg-white shadow-sm text-blue-600 font-bold\" : \"text-gray-500 hover:text-gray-700\"}`}\n                        >\n                          <Code size={18} />\n                          Coding\n                        </button>\n                      </div>\n\n                      {/* Question */}\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">Question Text</label>\n                        <textarea\n                          placeholder={type === \"mcq\" ? \"Enter your question here... (Paste question + 4 options to auto-fill)\" : \"Enter coding problem description...\"}\n                          className=\"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all\"\n                          rows=\"3\"\n                          value={question}\n                          onChange={handleQuestionChange}\n                          onPaste={type === \"mcq\" ? handlePaste : undefined}\n                          onKeyDown={handleKeyDown}\n                          required\n                        />\n                      </div>\n\n                      {type === \"mcq\" ? (\n                        /* Options */\n                        <div className=\"space-y-3\">\n                          <label className=\"block text-sm font-medium text-gray-700\">Options (Select Correct)</label>\n                          {options.map((opt, index) => (\n                            <div key={index} className=\"flex items-center gap-3 p-2 border border-gray-300 rounded-lg focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-blue-500 transition-all\">\n                              <input\n                                type=\"radio\"\n                                name=\"correctOption\"\n                                checked={correctOption === index}\n                                onChange={() => setCorrectOption(index)}\n                                className=\"w-4 h-4 text-blue-600 focus:ring-blue-500 cursor-pointer\"\n                              />\n                              <input\n                                placeholder={`Option ${index + 1}`}\n                                className={`flex-1 p-1 border-none outline-none bg-transparent ${correctOption === index ? \"font-medium\" : \"\"}`}\n                                value={opt}\n                                onChange={(e) => handleOptionChange(e.target.value, index)}\n                                required={type === \"mcq\"}\n                              />\n                            </div>\n                          ))}\n                        </div>\n                      ) : (\n                        /* Coding Fields */\n                        <div className=\"space-y-4\">\n                          <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Programming Language</label>\n                            <select\n                              value={language}\n                              onChange={(e) => setLanguage(e.target.value)}\n                              className=\"w-full p-2 border border-gray-300 rounded-lg outline-none focus:ring-2 focus:ring-blue-500\"\n                            >\n                              <option value=\"javascript\">JavaScript</option>\n                              <option value=\"python\">Python</option>\n                              <option value=\"java\">Java</option>\n                              <option value=\"cpp\">C++</option>\n                              <option value=\"c\">C</option>\n                            </select>\n                          </div>\n\n                          <div>\n                            <label className=\"block text-sm font-medium text-gray-700 mb-1\">Starter Code</label>\n                            <div className={`border border-gray-300 rounded-lg overflow-hidden ${isFullscreen ? \"h-[calc(100vh-400px)]\" : \"h-48\"}`}>\n                              <Editor\n                                height=\"100%\"\n                                language={language}\n                                theme=\"vs-light\"\n                                value={starterCode}\n                                onChange={(value) => setStarterCode(value)}\n                                options={{\n                                  minimap: { enabled: false },\n                                  fontSize: 12,\n                                  lineNumbers: \"on\",\n                                  scrollBeyondLastLine: false,\n                                }}\n                              />\n                            </div>\n                          </div>\n\n                          <div className=\"space-y-3\">\n                            <div className=\"flex justify-between items-center\">\n                              <label className=\"block text-sm font-medium text-gray-700\">Test Cases</label>\n                              <button\n                                type=\"button\"\n                                onClick={handleAddTestCase}\n                                className=\"text-blue-600 hover:text-blue-800 flex items-center gap-1 text-sm font-bold\"\n                              >\n                                <Plus size={16} />\n                                Add\n                              </button>\n                            </div>\n                            {testCases.map((tc, index) => (\n                              <div key={index} className=\"p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-3 relative group\">\n                                <button\n                                  type=\"button\"\n                                  onClick={() => handleRemoveTestCase(index)}\n                                  className=\"absolute top-2 right-2 text-red-500 hover:text-red-700 opacity-100 transition-opacity p-1 rounded-full bg-white\"\n                                  title=\"Remove Test Case\"\n                                >\n                                  <Trash2 size={18} />\n                                </button>\n                                <div>\n                                  <label className=\"block text-xs font-medium text-gray-600 mb-1\">Input (stdin)</label>\n                                  <textarea\n                                    placeholder=\"Input (stdin)\"\n                                    className=\"w-full p-2 border border-gray-300 rounded-lg outline-none text-sm\"\n                                    rows=\"2\"\n                                    value={tc.input}\n                                    onChange={(e) => handleTestCaseChange(index, \"input\", e.target.value)}\n                                  />\n                                </div>\n                                <div>\n                                  <label className=\"block text-xs font-medium text-gray-600 mb-1\">Expected Output</label>\n                                  <textarea\n                                    placeholder=\"Expected Output\"\n                                    className=\"w-full p-2 border border-gray-300 rounded-lg outline-none text-sm\"\n                                    rows=\"2\"\n                                    value={tc.expectedOutput}\n                                    onChange={(e) => handleTestCaseChange(index, \"expectedOutput\", e.target.value)}\n                                    required\n                                  />\n                                </div>\n                                <div className=\"flex items-center gap-2\">\n                                  <input\n                                    type=\"checkbox\"\n                                    id={`hidden-${index}`}\n                                    checked={tc.isHidden}\n                                    onChange={(e) => handleTestCaseChange(index, \"isHidden\", e.target.checked)}\n                                    className=\"w-4 h-4 text-blue-600 focus:ring-blue-500 rounded\"\n                                  />\n                                  <label htmlFor={`hidden-${index}`} className=\"text-sm font-medium text-gray-700\">Hidden Test Case</label>\n                                </div>\n                              </div>\n                            ))}\n                          </div>\n                        </div>\n                      )}\n\n                      <div className=\"flex gap-2 pt-2\">\n                        <button\n                          type=\"submit\"\n                          className=\"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium shadow-sm\"\n                        >\n                          {editingId ? \"Update\" : \"Add Question\"}\n                        </button>\n\n                        {editingId && (\n                          <button\n                            type=\"button\"\n                            onClick={handleCancelEdit}\n                            className=\"bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors\"\n                          >\n                            Cancel\n                          </button>\n                        )}\n                      </div>\n                    </form>\n                  </div>\n                </div>\n\n                {/* List Section */}\n                <div className={`${isFullscreen ? \"col-span-1\" : \"lg:col-span-2\"} space-y-4`}>\n                   <div className=\"flex justify-between items-center mb-2\">\n                      <h3 className=\"text-lg font-bold text-gray-700\">\n                        Existing Questions ({questionsList.length})\n                      </h3>\n                   </div>\n                  \n                  {questionsList.length === 0 ? (\n                    <div className=\"bg-white p-8 rounded-xl shadow text-center text-gray-500\">\n                      <p>No questions added yet for this exam.</p>\n                      <p className=\"text-sm mt-1\">Use the form on the left to add one.</p>\n                    </div>\n                  ) : (\n                    questionsList.map((q, i) => (\n                      <div key={q._id} className=\"bg-white p-5 rounded-xl shadow border border-gray-100 hover:shadow-md transition-shadow\">\n                        <div className=\"flex justify-between items-start mb-3\">\n                          <h4 className=\"font-semibold text-lg text-gray-800 pr-4\">\n                            <span className=\"text-blue-600 mr-2\">Q{i + 1}.</span>{q.question}\n                            {q.type === \"coding\" && (\n                              <span className=\"ml-2 text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded-full font-bold\">\n                                Coding\n                              </span>\n                            )}\n                          </h4>\n                          <div className=\"flex gap-2 shrink-0\">\n                            <button\n                              onClick={() => handleEdit(q)}\n                              className=\"text-blue-600 hover:text-blue-800 text-sm font-medium px-2 py-1 rounded hover:bg-blue-50 transition-colors\"\n                              disabled={isPublished}\n                            >\n                              Edit\n                            </button>\n                            <button\n                              onClick={() => handleDelete(q._id)}\n                              className=\"text-red-600 hover:text-red-800 text-sm font-medium px-2 py-1 rounded hover:bg-red-50 transition-colors\"\n                              disabled={isPublished}\n                            >\n                              Delete\n                            </button>\n                          </div>\n                        </div>\n                        {q.type === \"mcq\" ? (\n                          <ul className=\"pl-2 space-y-2\">\n                            {q.options.map((opt, idx) => (\n                              <li\n                                key={idx}\n                                className={`flex items-center px-3 py-2 rounded-lg text-sm ${\n                                  q.correctOption === idx\n                                    ? \"bg-green-50 text-green-700 border border-green-200 font-medium\"\n                                    : \"bg-gray-50 text-gray-600 border border-transparent\"\n                                }`}\n                              >\n                                <span className={`w-6 h-6 flex items-center justify-center rounded-full mr-3 text-xs ${q.correctOption === idx ? \"bg-green-200 text-green-800\" : \"bg-gray-200 text-gray-600\"}`}>\n                                  {String.fromCharCode(65 + idx)}\n                                </span>\n                                {opt}\n                                {q.correctOption === idx && <span className=\"ml-auto text-xs bg-green-200 text-green-800 px-2 py-0.5 rounded-full\">Correct</span>}\n                              </li>\n                            ))}\n                          </ul>\n                        ) : (\n                          <div className=\"pl-2 space-y-2\">\n                            <div className=\"flex items-center gap-2 text-sm text-gray-600\">\n                              <span className=\"font-bold\">Language:</span>\n                              <span className=\"bg-gray-100 px-2 py-0.5 rounded uppercase text-xs\">{q.codingData.language}</span>\n                            </div>\n                            {q.codingData?.testCases && (\n                              <div className=\"mt-4 border-t pt-4\">\n                                <p className=\"text-sm font-medium text-gray-700 mb-2\">Test Cases:</p>\n                                <div className=\"space-y-3\">\n                                  {q.codingData.testCases.map((tc, tcIndex) => (\n                                    <div key={tcIndex} className=\"bg-gray-100 p-3 rounded-lg border border-gray-200\">\n                                      <p className=\"text-xs text-gray-600\">\n                                        <span className=\"font-semibold\">Input:</span> {tc.input || \"N/A\"}\n                                      </p>\n                                      <p className=\"text-xs text-gray-600\">\n                                        <span className=\"font-semibold\">Expected Output:</span> {tc.expectedOutput || \"N/A\"}\n                                      </p>\n                                      <p className=\"text-xs text-gray-600\">\n                                        <span className=\"font-semibold\">Hidden:</span> {tc.isHidden ? \"Yes\" : \"No\"}\n                                      </p>\n                                    </div>\n                                  ))}\n                                </div>\n                              </div>\n                            )}\n                          </div>\n                        )}\n                      </div>\n                    ))\n                  )}\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default AddQuestions;\n","usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\pages\\admin\\CreateExam.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\pages\\admin\\Dashboard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\pages\\admin\\EditExam.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchExam'. Either include it or remove the dependency array.","line":95,"column":6,"nodeType":"ArrayExpression","endLine":95,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchExam, id]","fix":{"range":[2953,2957],"text":"[fetchExam, id]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport toast from \"react-hot-toast\";\n\nimport AdminSidebar from \"../../components/AdminSidebar\";\nimport AdminHeader from \"../../components/AdminHeader\";\nimport { getExamById, updateExam } from \"../../api/examApi\";\nimport { getUsers } from \"../../api/adminApi\";\nimport { getDepartments } from \"../../api/departmentApi\";\n\nconst EditExam = () => {\n  const { id } = useParams();\n  const navigate = useNavigate();\n  const [exam, setExam] = useState(null);\n  const [users, setUsers] = useState([]);\n  const [departments, setDepartments] = useState([]);\n  const [expandedDepts, setExpandedDepts] = useState([]);\n  const [loading, setLoading] = useState(true);\n  \n  // Assignment State\n  const [assignmentMode, setAssignmentMode] = useState(\"department\"); // 'department' or 'specific'\n  const [selectedDepartment, setSelectedDepartment] = useState(\"All\");\n\n  function formatDateTimeLocal(isoString) {\n    if (!isoString) return \"\";\n    const date = new Date(isoString);\n    const offset = date.getTimezoneOffset() * 60000;\n    const localDate = new Date(date.getTime() - offset);\n    return localDate.toISOString().slice(0, 16);\n  }\n\n  async function loadDepartments() {\n    try {\n      const res = await getDepartments();\n      setDepartments(res.data);\n    } catch (err) {\n      console.error(\"Failed to load departments\", err);\n    }\n  }\n\n  async function fetchExam() {\n    try {\n      const res = await getExamById(id);\n      const data = res.data;\n      \n      setExam({\n        ...data,\n        assignedTo: data.assignedTo || [],\n        startTime: data.startTime ? formatDateTimeLocal(data.startTime) : \"\",\n        endTime: data.endTime ? formatDateTimeLocal(data.endTime) : \"\",\n        proctoring: data.proctoring || {\n          webcam: false,\n          fullScreen: false,\n          tabSwitch: false,\n          screenRecording: false,\n          tabSwitchLimit: 3,\n        },\n      });\n\n      // Initialize Assignment State\n      if (data.assignedTo && data.assignedTo.length > 0) {\n        setAssignmentMode(\"specific\");\n      } else {\n        setAssignmentMode(\"department\");\n      }\n      setSelectedDepartment(data.department || \"All\");\n      \n      setLoading(false);\n    } catch (error) {\n      console.error(\"Failed to fetch exam\", error);\n      toast.error(\"Failed to load exam details\");\n      navigate(\"/admin/manage-exams\");\n    }\n  }\n\n  async function loadUsers() {\n    try {\n      const res = await getUsers();\n      // Filter only students and employees\n      const filtered = res.data.filter(u => u.role === \"student\" || u.role === \"employee\");\n      setUsers(filtered);\n    } catch (err) {\n      console.error(\"Failed to load users\", err);\n    }\n  }\n\n  useEffect(() => {\n    const timeoutId = setTimeout(() => {\n      fetchExam();\n      loadUsers();\n      loadDepartments();\n    }, 0);\n\n    return () => clearTimeout(timeoutId);\n  }, [id]);\n\n  const handleDateChange = (field, value) => {\n    const newState = { ...exam, [field]: value };\n    \n    if (newState.startTime && newState.endTime) {\n      const start = new Date(newState.startTime);\n      const end = new Date(newState.endTime);\n      const diffMs = end - start;\n      const diffMins = Math.floor(diffMs / 60000);\n      \n      if (diffMins > 0) {\n        newState.duration = diffMins;\n      }\n    }\n    setExam(newState);\n  };\n\n  const handleUserSelect = (userId) => {\n    setExam((prev) => {\n      const current = prev.assignedTo || [];\n      if (current.includes(userId)) {\n        return { ...prev, assignedTo: current.filter((id) => id !== userId) };\n      } else {\n        return { ...prev, assignedTo: [...current, userId] };\n      }\n    });\n  };\n\n  const toggleDept = (dept) => {\n    setExpandedDepts(prev => \n      prev.includes(dept) ? prev.filter(d => d !== dept) : [...prev, dept]\n    );\n  };\n\n  const groupedUsers = users.reduce((acc, user) => {\n    const dept = user.department || \"General\";\n    if (!acc[dept]) acc[dept] = [];\n    acc[dept].push(user);\n    return acc;\n  }, {});\n\n  const handleUpdate = async () => {\n    const now = new Date();\n    const start = exam.startTime ? new Date(exam.startTime) : null;\n    const end = exam.endTime ? new Date(exam.endTime) : null;\n\n    if (start && start < now) {\n      toast.error(\"Start Time cannot be in the past.\");\n      return;\n    }\n\n    if (end && end < now) {\n      toast.error(\"End Time cannot be in the past.\");\n      return;\n    }\n\n    if (start && end && start >= end) {\n      toast.error(\"End Time must be after Start Time.\");\n      return;\n    }\n\n    // Validation for Specific Mode\n    if (assignmentMode === \"specific\" && (!exam.assignedTo || exam.assignedTo.length === 0)) {\n      toast.error(\"Please select at least one student or switch to Department mode.\");\n      return;\n    }\n\n    // Validation for Department Mode (Prevent publishing to empty departments)\n    if (assignmentMode === \"department\" && exam.isPublished) {\n        if (selectedDepartment === \"All\") {\n            if (users.length === 0) {\n                toast.error(\"No students found in the system. Cannot publish exam.\");\n                return;\n            }\n        } else {\n            // Check if there are any students in the selected department\n            // We use the same 'users' list which is already filtered for students/employees\n            const usersInDept = users.filter(u => (u.department || \"General\") === selectedDepartment);\n            if (usersInDept.length === 0) {\n                toast.error(`No candidates found in '${selectedDepartment}' department. Cannot publish exam.`);\n                return;\n            }\n        }\n    }\n\n    try {\n      const payload = {\n        ...exam,\n        startTime: exam.startTime ? new Date(exam.startTime).toISOString() : null,\n        endTime: exam.endTime ? new Date(exam.endTime).toISOString() : null,\n        proctoring: exam.proctoring,\n        // If specific, use assignedTo. If department, clear assignedTo.\n        assignedTo: assignmentMode === \"specific\" ? exam.assignedTo : [],\n        // Always save the selected department (even if in specific mode) to preserve metadata\n        department: selectedDepartment,\n      };\n      await updateExam(exam._id, payload);\n      \n      if (exam.isPublished) {\n         if (assignmentMode === \"specific\") {\n             toast.success(`Exam published ONLY to ${exam.assignedTo.length} specific student(s).`);\n         } else {\n             if (selectedDepartment === \"All\") {\n                 toast.success(\"Exam published to ALL Departments.\");\n             } else {\n                 toast.success(`Exam published ONLY to '${selectedDepartment}' Department. (Not visible to others)`);\n             }\n         }\n      } else {\n        if (assignmentMode === \"specific\") {\n            toast.success(\"Exam updated successfully (Draft - Specific Students)\");\n        } else {\n            toast.success(`Exam updated successfully (Draft - ${selectedDepartment})`);\n        }\n      }\n      \n      navigate(\"/admin/manage-exams\");\n    } catch (error) {\n      const message = error.response?.data?.message || \"Update failed\";\n      toast.error(message);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex\">\n        <AdminSidebar />\n        <div className=\"ml-64 w-full min-h-screen bg-gray-100 flex items-center justify-center\">\n          Loading...\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex\">\n      <AdminSidebar />\n      <div className=\"ml-64 w-full min-h-screen bg-gray-100\">\n        <AdminHeader />\n\n        <div className=\"p-6 max-w-6xl mx-auto\">\n          <div className=\"flex items-center justify-between mb-6\">\n            <div className=\"flex items-center gap-4\">\n              <button \n                onClick={() => navigate(\"/admin/manage-exams\")}\n                className=\"p-2 rounded-full hover:bg-white transition\"\n              >\n                <svg className=\"w-6 h-6 text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M10 19l-7-7m0 0l7-7m-7 7h18\" />\n                </svg>\n              </button>\n              <h2 className=\"text-2xl font-bold text-gray-800\">Edit Exam</h2>\n            </div>\n          </div>\n\n          <div className=\"bg-white rounded-2xl shadow-xl overflow-hidden\">\n             <div className=\"p-6 grid grid-cols-1 md:grid-cols-2 gap-8\">\n               \n               {/* LEFT COLUMN: Basic Info */}\n               <div className=\"space-y-6\">\n                 <h4 className=\"text-lg font-semibold text-blue-800 border-b pb-2\">Basic Details</h4>\n                 \n                 <div className=\"space-y-4\">\n                   <div>\n                     <label className=\"block text-sm font-medium text-gray-700 mb-1\">Exam Title</label>\n                     <input\n                       className=\"w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\n                       value={exam.title}\n                       onChange={(e) => setExam({ ...exam, title: e.target.value })}\n                     />\n                   </div>\n\n                   <div className=\"grid grid-cols-2 gap-4\">\n                     <div>\n                       <label className=\"block text-sm font-medium text-gray-700 mb-1\">Duration (min)</label>\n                       <input\n                         type=\"number\"\n                         className=\"w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\n                         value={exam.duration}\n                         onChange={(e) => setExam({ ...exam, duration: e.target.value })}\n                       />\n                     </div>\n                     <div>\n                       <label className=\"block text-sm font-medium text-gray-700 mb-1\">Attempt Limit</label>\n                       <input\n                         type=\"number\"\n                         min=\"1\"\n                         className=\"w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\n                         value={exam.attemptLimit || 1}\n                         onChange={(e) => setExam({ ...exam, attemptLimit: e.target.value })}\n                       />\n                     </div>\n                   </div>\n\n                   <div>\n                     <label className=\"block text-sm font-medium text-gray-700 mb-1\">Negative Marking</label>\n                     <input\n                       type=\"number\"\n                       step=\"0.01\"\n                       className=\"w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\n                       value={exam.negativeMarking}\n                       onChange={(e) => setExam({ ...exam, negativeMarking: e.target.value })}\n                     />\n                     <p className=\"text-xs text-gray-500 mt-1\">Example: 0.25 for 1/4th deduction</p>\n                   </div>\n\n                   <div className=\"grid grid-cols-2 gap-4\">\n                     <div>\n                       <label className=\"block text-sm font-medium text-gray-700 mb-1\">Start Time</label>\n                       <input\n                         type=\"datetime-local\"\n                         className=\"w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\n                         value={exam.startTime}\n                         onChange={(e) => handleDateChange(\"startTime\", e.target.value)}\n                       />\n                     </div>\n                     <div>\n                       <label className=\"block text-sm font-medium text-gray-700 mb-1\">End Time</label>\n                       <input\n                         type=\"datetime-local\"\n                         className=\"w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\n                         value={exam.endTime}\n                         onChange={(e) => handleDateChange(\"endTime\", e.target.value)}\n                       />\n                     </div>\n                   </div>\n                   \n                   <div className=\"flex items-center gap-3 p-4 bg-blue-50 rounded-lg border border-blue-100 mt-4\">\n                     <input\n                       type=\"checkbox\"\n                       id=\"edit-published\"\n                       className=\"w-5 h-5 text-blue-600 rounded focus:ring-blue-500\"\n                       checked={exam.isPublished || false}\n                       onChange={(e) => setExam({ ...exam, isPublished: e.target.checked })}\n                     />\n                     <label htmlFor=\"edit-published\" className=\"font-medium text-gray-700\">Publish Exam</label>\n                   </div>\n                 </div>\n               </div>\n\n               {/* RIGHT COLUMN: Settings & Assignment */}\n               <div className=\"space-y-6\">\n                 \n                 {/* PROCTORING */}\n                 <div>\n                   <h4 className=\"text-lg font-semibold text-blue-800 border-b pb-2 mb-4\">Proctoring Settings</h4>\n                   <div className=\"bg-gray-50 p-4 rounded-xl border space-y-3\">\n                     <div className=\"grid grid-cols-2 gap-3\">\n                       <label className=\"flex items-center gap-2 cursor-pointer p-2 hover:bg-white rounded transition\">\n                         <input\n                           type=\"checkbox\"\n                           className=\"w-4 h-4 text-blue-600 rounded\"\n                           checked={exam.proctoring?.webcam}\n                           onChange={(e) => setExam({\n                             ...exam,\n                             proctoring: { ...exam.proctoring, webcam: e.target.checked }\n                           })}\n                         />\n                         <span className=\"text-gray-700 font-medium\">Webcam</span>\n                       </label>\n                       \n                       <label className=\"flex items-center gap-2 cursor-pointer p-2 hover:bg-white rounded transition\">\n                         <input\n                           type=\"checkbox\"\n                           className=\"w-4 h-4 text-blue-600 rounded\"\n                           checked={exam.proctoring?.fullScreen}\n                           onChange={(e) => setExam({\n                             ...exam,\n                             proctoring: { ...exam.proctoring, fullScreen: e.target.checked }\n                           })}\n                         />\n                         <span className=\"text-gray-700 font-medium\">Fullscreen</span>\n                       </label>\n\n                       <label className=\"flex items-center gap-2 cursor-pointer p-2 hover:bg-white rounded transition\">\n                         <input\n                           type=\"checkbox\"\n                           className=\"w-4 h-4 text-blue-600 rounded\"\n                           checked={exam.proctoring?.screenRecording}\n                           onChange={(e) => setExam({\n                             ...exam,\n                             proctoring: { ...exam.proctoring, screenRecording: e.target.checked }\n                           })}\n                         />\n                         <span className=\"text-gray-700 font-medium\">Screen Rec</span>\n                       </label>\n\n                       <label className=\"flex items-center gap-2 cursor-pointer p-2 hover:bg-white rounded transition\">\n                         <input\n                           type=\"checkbox\"\n                           className=\"w-4 h-4 text-blue-600 rounded\"\n                           checked={exam.proctoring?.tabSwitch}\n                           onChange={(e) => setExam({\n                             ...exam,\n                             proctoring: { ...exam.proctoring, tabSwitch: e.target.checked }\n                           })}\n                         />\n                         <span className=\"text-gray-700 font-medium\">Tab Switch</span>\n                       </label>\n                     </div>\n\n                     {exam.proctoring?.tabSwitch && (\n                       <div className=\"mt-2 pt-2 border-t flex items-center gap-3\">\n                         <span className=\"text-sm text-gray-600\">Max Violations Allowed:</span>\n                         <input\n                           type=\"number\"\n                           className=\"w-16 p-1 border rounded text-center font-medium focus:ring-2 focus:ring-blue-500 outline-none\"\n                           value={exam.proctoring?.tabSwitchLimit}\n                           onChange={(e) => setExam({\n                             ...exam,\n                             proctoring: { ...exam.proctoring, tabSwitchLimit: Number(e.target.value) }\n                           })}\n                         />\n                       </div>\n                     )}\n                   </div>\n                 </div>\n\n                 {/* ASSIGNMENT */}\n                <div>\n                  <h4 className=\"text-lg font-semibold text-blue-800 border-b pb-2 mb-4\">Assign Candidates</h4>\n                  \n                  {/* Assignment Mode Toggle */}\n                  <div className=\"flex gap-4 mb-4\">\n                    <label className=\"flex items-center gap-2 cursor-pointer\">\n                      <input \n                        type=\"radio\" \n                        name=\"assignmentMode\"\n                        value=\"department\"\n                        checked={assignmentMode === \"department\"}\n                        onChange={() => setAssignmentMode(\"department\")}\n                        className=\"w-4 h-4 text-blue-600\"\n                      />\n                      <span className=\"text-gray-700 font-medium\">By Department</span>\n                    </label>\n\n                    <label className=\"flex items-center gap-2 cursor-pointer\">\n                      <input \n                        type=\"radio\" \n                        name=\"assignmentMode\"\n                        value=\"specific\"\n                        checked={assignmentMode === \"specific\"}\n                        onChange={() => setAssignmentMode(\"specific\")}\n                        className=\"w-4 h-4 text-blue-600\"\n                      />\n                      <span className=\"text-gray-700 font-medium\">Specific Students</span>\n                    </label>\n                  </div>\n\n                  {/* DEPARTMENT SELECTOR */}\n                  {assignmentMode === \"department\" && (\n                    <div className=\"mb-4\">\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">Select Department</label>\n                      <select\n                        className=\"w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\n                        value={selectedDepartment}\n                        onChange={(e) => setSelectedDepartment(e.target.value)}\n                      >\n                        <option value=\"All\">All Departments</option>\n                        {departments.map((dept) => (\n                          <option key={dept._id} value={dept.name}>\n                            {dept.name}\n                          </option>\n                        ))}\n                      </select>\n                      <p className=\"text-xs text-gray-500 mt-1\">\n                        Exam will be visible to all students in the selected department.\n                      </p>\n                    </div>\n                  )}\n\n                  {/* SPECIFIC STUDENTS LIST */}\n                  {assignmentMode === \"specific\" && (\n                  <div className={`bg-gray-50 border rounded-xl overflow-hidden flex flex-col h-64 transition-opacity`}>\n                    <div className=\"p-2 bg-gray-100 border-b text-xs font-semibold text-gray-500 uppercase tracking-wider\">\n                      Select Students\n                    </div>\n                     <div className=\"overflow-y-auto flex-1 p-2 space-y-2\">\n                       {Object.keys(groupedUsers).length === 0 ? (\n                         <div className=\"h-full flex items-center justify-center text-gray-500 italic\">\n                           No candidates found.\n                         </div>\n                       ) : (\n                         Object.entries(groupedUsers).map(([dept, deptUsers]) => (\n                           <div key={dept} className=\"border rounded-lg bg-white overflow-hidden shadow-sm\">\n                             <button\n                               onClick={() => toggleDept(dept)}\n                               className=\"w-full flex items-center justify-between p-3 bg-gray-100 hover:bg-gray-200 transition text-left\"\n                             >\n                               <span className=\"font-medium text-gray-700\">{dept} <span className=\"text-xs text-gray-500\">({deptUsers.length})</span></span>\n                               <svg \n                                 className={`w-4 h-4 text-gray-500 transition-transform duration-200 ${expandedDepts.includes(dept) ? 'rotate-180' : ''}`} \n                                 fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"\n                               >\n                                 <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M19 9l-7 7-7-7\" />\n                               </svg>\n                             </button>\n                             \n                             {expandedDepts.includes(dept) && (\n                               <div className=\"p-2 space-y-1 bg-white border-t animate-in slide-in-from-top-1 duration-200\">\n                                 {deptUsers.map((u) => (\n                                   <label \n                                     key={u._id} \n                                     className={`flex items-center gap-3 p-2 rounded-md border transition cursor-pointer hover:bg-gray-50 ${\n                                       exam.assignedTo?.includes(u._id) ? 'bg-blue-50 border-blue-200' : 'border-gray-100'\n                                     }`}\n                                   >\n                                     <input\n                                       type=\"checkbox\"\n                                       className=\"w-4 h-4 text-blue-600 rounded focus:ring-blue-500\"\n                                       checked={exam.assignedTo?.includes(u._id)}\n                                       onChange={() => handleUserSelect(u._id)}\n                                     />\n                                     <div className=\"flex flex-col\">\n                                       <span className=\"font-medium text-gray-800 text-sm\">{u.name}</span>\n                                       <span className=\"text-xs text-gray-500\">ID: {u.employeeId || \"N/A\"}</span>\n                                     </div>\n                                   </label>\n                                 ))}\n                               </div>\n                             )}\n                           </div>\n                         ))\n                       )}\n                     </div>\n                     <div className=\"p-2 bg-gray-100 border-t text-xs text-center text-gray-500\">\n                        {exam.assignedTo?.length > 0 \n                          ? `${exam.assignedTo.length} candidates selected`\n                          : \"No candidates selected (Exam will NOT be published)\"}\n                    </div>\n                  </div>\n                  )}\n                </div>\n\n               </div>\n             </div>\n\n             {/* FOOTER */}\n             <div className=\"p-6 border-t bg-gray-50 flex justify-end gap-3 rounded-b-2xl\">\n               <button\n                 onClick={() => navigate(\"/admin/manage-exams\")}\n                 className=\"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 font-medium transition\"\n               >\n                 Cancel\n               </button>\n               <button\n                 onClick={handleUpdate}\n                 className=\"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium shadow-lg hover:shadow-xl transition transform active:scale-95\"\n               >\n                 Save Changes\n               </button>\n             </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default EditExam;\n","usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\pages\\admin\\ManageDepartments.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\pages\\admin\\ManageExams.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\pages\\admin\\Reports.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\pages\\admin\\ResultAnalysis.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\pages\\admin\\Results.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\pages\\auth\\Login.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\pages\\auth\\Register.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\pages\\student\\Exam.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'navigate'. Either include it or remove the dependency array.","line":188,"column":6,"nodeType":"ArrayExpression","endLine":188,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [examId, navigate]","fix":{"range":[6949,6957],"text":"[examId, navigate]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'triggerAutoSave'. Either include it or remove the dependency array.","line":479,"column":6,"nodeType":"ArrayExpression","endLine":479,"endColumn":42,"suggestions":[{"desc":"Update the dependencies array to be: [answers, questions, examId, marked, triggerAutoSave]","fix":{"range":[16851,16887],"text":"[answers, questions, examId, marked, triggerAutoSave]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState, useRef } from \"react\";\r\nimport { useParams, useNavigate } from \"react-router-dom\";\r\nimport toast from \"react-hot-toast\";\r\nimport axios from \"../../api/axiosInstance\";\r\nimport { Maximize2, Minimize2, Move } from \"lucide-react\";\r\n\r\nimport Timer from \"../../components/Timer\";\r\nimport QuestionCard from \"../../components/QuestionCard\";\r\nimport QuestionPalette from \"../../components/QuestionPalette\";\r\nimport SubmitModal from \"../../components/SubmitModal\";\r\nimport CodingEnvironment from \"../../components/CodingEnvironment\";\r\n\r\nimport { getQuestions } from \"../../api/examApi\";\r\nimport { autoSave, resumeExam, submitExam } from \"../../api/resultApi\";\r\n\r\nconst Exam = () => {\r\n  const { examId } = useParams();\r\n  const navigate = useNavigate();\r\n\r\n  const [questions, setQuestions] = useState([]);\r\n  const [answers, setAnswers] = useState({});\r\n  const [marked, setMarked] = useState(new Set()); // Stores indices\r\n  const [current, setCurrent] = useState(0);\r\n  const [showSubmit, setShowSubmit] = useState(false);\r\n  const [isAutoSubmitting, setIsAutoSubmitting] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n  const [initialSeconds, setInitialSeconds] = useState(null);\r\n\r\n  // Store exam data\r\n  const [exam, setExam] = useState(null);\r\n\r\n  // PROCTORING STATE\r\n  const [tabSwitches, setTabSwitches] = useState(0);\r\n  const [_deviceViolations, setDeviceViolations] = useState(0); // Track device issues\r\n  const [isFullScreen, setIsFullScreen] = useState(false);\r\n  const logsRef = useRef([]);\r\n  const videoRef = useRef(null);\r\n  const mediaStreamRef = useRef(null); // Store stream for monitoring\r\n  const finalSubmitRef = useRef(null); // Ref for finalSubmit to avoid stale closures in intervals\r\n  const canvasRef = useRef(document.createElement(\"canvas\")); // Off-screen canvas for analysis\r\n\r\n  // RECORDING REFS\r\n  const webcamRecorderRef = useRef(null);\r\n  const screenRecorderRef = useRef(null);\r\n  const webcamChunksRef = useRef([]);\r\n  const screenChunksRef = useRef([]);\r\n  const screenStreamRef = useRef(null);\r\n  const audioContextRef = useRef(null); // Store AudioContext to close it later\r\n  const [hasScreenShare, setHasScreenShare] = useState(false);\r\n\r\n  // CAMERA DRAG STATE\r\n  const [cameraPos, setCameraPos] = useState({ x: 0, y: 0 });\r\n  const isDraggingRef = useRef(false);\r\n  const dragStartRef = useRef({ x: 0, y: 0 });\r\n\r\n  const handleDragStart = (e) => {\r\n    e.preventDefault();\r\n    isDraggingRef.current = true;\r\n    dragStartRef.current = { x: e.clientX - cameraPos.x, y: e.clientY - cameraPos.y };\r\n  };\r\n\r\n  useEffect(() => {\r\n    const handleDragMove = (e) => {\r\n      if (!isDraggingRef.current) return;\r\n      const newX = e.clientX - dragStartRef.current.x;\r\n      const newY = e.clientY - dragStartRef.current.y;\r\n      setCameraPos({ x: newX, y: newY });\r\n    };\r\n\r\n    const handleDragEnd = () => {\r\n      isDraggingRef.current = false;\r\n    };\r\n\r\n    window.addEventListener(\"mousemove\", handleDragMove);\r\n    window.addEventListener(\"mouseup\", handleDragEnd);\r\n    return () => {\r\n      window.removeEventListener(\"mousemove\", handleDragMove);\r\n      window.removeEventListener(\"mouseup\", handleDragEnd);\r\n    };\r\n  }, []);\r\n\r\n  const addLog = (type, message) => {\r\n    logsRef.current.push({ type, message, timestamp: new Date() });\r\n  };\r\n\r\n  /* ================= PREVENT NAVIGATION ================= */\r\n  useEffect(() => {\r\n    // 1. Push state to prevent back navigation\r\n    window.history.pushState(null, document.title, window.location.href);\r\n\r\n    const handlePopState = () => {\r\n      window.history.pushState(null, document.title, window.location.href);\r\n      toast.error(\"Navigation is disabled during the exam!\");\r\n    };\r\n\r\n    // 2. Prevent Refresh/Close\r\n    const handleBeforeUnload = (e) => {\r\n       e.preventDefault(); \r\n       e.returnValue = \"Are you sure you want to leave? Your exam will be submitted.\";\r\n       return e.returnValue;\r\n    };\r\n\r\n    window.addEventListener(\"popstate\", handlePopState);\r\n    window.addEventListener(\"beforeunload\", handleBeforeUnload);\r\n\r\n    return () => {\r\n      window.removeEventListener(\"popstate\", handlePopState);\r\n      window.removeEventListener(\"beforeunload\", handleBeforeUnload);\r\n    };\r\n  }, []);\r\n\r\n  /* ================= LOAD QUESTIONS + RESUME ================= */\r\n  useEffect(() => {\r\n    const loadExam = async () => {\r\n      try {\r\n        const examRes = await axios.get(`/exams/${examId}`);\r\n        setExam(examRes.data);\r\n        console.log(\"EXAM OBJECT FROM BACKEND:\", examRes.data);\r\n\r\n        const qRes = await getQuestions(examId);\r\n        setQuestions(qRes.data);\r\n\r\n        const saved = await resumeExam(examId);\r\n        \r\n        if (saved.data) {\r\n          // Check if already submitted\r\n          if (saved.data.status === \"submitted\") {\r\n             toast.error(\"You have already completed this exam.\");\r\n             navigate(`/student/result/${examId}`, { replace: true });\r\n             return;\r\n          }\r\n\r\n          // Restore Answers\r\n          if (saved.data.answers) {\r\n            const restored = {};\r\n            saved.data.answers.forEach((a) => {\r\n              const index = qRes.data.findIndex(\r\n                (q) => q._id === a.questionId\r\n              );\r\n              if (index !== -1) {\r\n                if (qRes.data[index].type === \"coding\") {\r\n                  restored[index] = {\r\n                    code: a.code,\r\n                    language: a.language,\r\n                    isCorrect: a.isCorrect,\r\n                  };\r\n                } else {\r\n                  restored[index] = a.selectedOption;\r\n                }\r\n              }\r\n            });\r\n            setAnswers(restored);\r\n          }\r\n\r\n          // Restore Marked for Review\r\n          if (saved.data.markedForReview) {\r\n            const restoredMarked = new Set();\r\n            saved.data.markedForReview.forEach((qId) => {\r\n              const index = qRes.data.findIndex((q) => q._id === qId);\r\n              if (index !== -1) restoredMarked.add(index);\r\n            });\r\n            setMarked(restoredMarked);\r\n          }\r\n\r\n          // Restore Timer\r\n          if (saved.data.startedAt) {\r\n             const elapsed = Math.floor((Date.now() - new Date(saved.data.startedAt).getTime()) / 1000);\r\n             const durationSeconds = examRes.data.duration * 60;\r\n             const remaining = durationSeconds - elapsed;\r\n             setInitialSeconds(remaining > 0 ? remaining : 0);\r\n          } else {\r\n             // Should not happen if saved data exists but startedAt is missing, fallback\r\n             setInitialSeconds(examRes.data.duration * 60);\r\n          }\r\n        } else {\r\n          // New Attempt\r\n          setInitialSeconds(examRes.data.duration * 60);\r\n        }\r\n\r\n      } catch {\r\n        toast.error(\"Failed to load exam\");\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    loadExam();\r\n  }, [examId]);\r\n\r\n\r\n  /* ================= STOP MEDIA ================= */\r\n  const stopMediaStream = () => {\r\n    // 1. Stop from Ref\r\n    if (mediaStreamRef.current) {\r\n      mediaStreamRef.current.getTracks().forEach((track) => {\r\n        track.stop();\r\n        track.enabled = false;\r\n      });\r\n      mediaStreamRef.current = null;\r\n    }\r\n    \r\n    // 2. Stop from Video Element (failsafe for orphans)\r\n    if (videoRef.current && videoRef.current.srcObject) {\r\n      const stream = videoRef.current.srcObject;\r\n      if (stream.getTracks) {\r\n        stream.getTracks().forEach((track) => {\r\n          track.stop();\r\n          track.enabled = false;\r\n        });\r\n      }\r\n      videoRef.current.srcObject = null;\r\n    }\r\n\r\n    // 3. Stop Screen Stream\r\n    if (screenStreamRef.current) {\r\n      screenStreamRef.current.getTracks().forEach((track) => {\r\n        track.stop();\r\n        track.enabled = false;\r\n      });\r\n      screenStreamRef.current = null;\r\n    }\r\n\r\n    // 4. Close AudioContext\r\n    if (audioContextRef.current) {\r\n        audioContextRef.current.close().catch(e => console.error(\"Error closing AudioContext:\", e));\r\n        audioContextRef.current = null;\r\n    }\r\n  };\r\n\r\n  /* ================= PROCTORING LOGIC ================= */\r\n  useEffect(() => {\r\n    if (!exam) return;\r\n\r\n    let isMounted = true;\r\n\r\n    // 1. WEBCAM & MIC SETUP\r\n    if (exam.proctoring?.webcam) {\r\n      navigator.mediaDevices\r\n        .getUserMedia({ video: true, audio: true })\r\n        .then((stream) => {\r\n          if (!isMounted) {\r\n            // Unmounted before stream ready -> kill it immediately\r\n            stream.getTracks().forEach((track) => track.stop());\r\n            return;\r\n          }\r\n\r\n          mediaStreamRef.current = stream;\r\n          if (videoRef.current) {\r\n            videoRef.current.srcObject = stream;\r\n            videoRef.current.play().catch(() => {});\r\n          }\r\n\r\n          // START RECORDING\r\n          const mimeTypes = [\r\n              \"video/webm;codecs=vp9,opus\",\r\n              \"video/webm;codecs=vp8,opus\",\r\n              \"video/webm\"\r\n          ];\r\n          const selectedMimeType = mimeTypes.find(type => MediaRecorder.isTypeSupported(type));\r\n\r\n          if (selectedMimeType) {\r\n             const recorder = new MediaRecorder(stream, { \r\n                 mimeType: selectedMimeType,\r\n                 audioBitsPerSecond: 128000,\r\n                 videoBitsPerSecond: 1000000 // Webcam needs less bandwidth\r\n             });\r\n             recorder.ondataavailable = (e) => {\r\n                if (e.data.size > 0) webcamChunksRef.current.push(e.data);\r\n             };\r\n             recorder.start(1000); \r\n             webcamRecorderRef.current = recorder;\r\n          }\r\n        })\r\n        .catch(() => {\r\n          if (!isMounted) return;\r\n          toast.error(\"Webcam/Mic access required!\");\r\n          addLog(\"webcam_error\", \"Failed to access webcam/mic\");\r\n        });\r\n    }\r\n\r\n    // 2. FULLSCREEN\r\n    let handleFullScreenChange;\r\n    if (exam.proctoring?.fullScreen) {\r\n      handleFullScreenChange = () => {\r\n        const isFull = !!document.fullscreenElement;\r\n        setIsFullScreen(isFull);\r\n        if (!isFull) {\r\n            addLog(\"fullscreen_exit\", \"Exited fullscreen\");\r\n        }\r\n      };\r\n      document.addEventListener(\"fullscreenchange\", handleFullScreenChange);\r\n    }\r\n\r\n    // CLEANUP\r\n    return () => {\r\n      isMounted = false;\r\n      stopMediaStream();\r\n      if (handleFullScreenChange) {\r\n        document.removeEventListener(\"fullscreenchange\", handleFullScreenChange);\r\n      }\r\n    };\r\n  }, [exam]);\r\n\r\n  // Re-attach stream when video element mounts (e.g. after entering fullscreen)\r\n  useEffect(() => {\r\n    if (videoRef.current && mediaStreamRef.current) {\r\n      videoRef.current.srcObject = mediaStreamRef.current;\r\n      videoRef.current.play().catch(e => console.error(\"Play error:\", e));\r\n    }\r\n  }, [isFullScreen, exam]);\r\n\r\n  // 3. DEVICE MONITORING (Video/Mic + Black Screen Detection)\r\n  useEffect(() => {\r\n    if (!exam?.proctoring?.webcam) return;\r\n\r\n    const interval = setInterval(() => {\r\n      const stream = mediaStreamRef.current;\r\n      const videoEl = videoRef.current;\r\n\r\n      let issue = null;\r\n\r\n      // Check 1: Stream integrity\r\n      if (!stream) {\r\n        issue = \"Camera disconnected\";\r\n      } else {\r\n        const videoTrack = stream.getVideoTracks()[0];\r\n        const audioTrack = stream.getAudioTracks()[0];\r\n\r\n        if (!videoTrack || videoTrack.readyState !== 'live' || !videoTrack.enabled || videoTrack.muted) {\r\n           issue = \"Camera is off or blocked\";\r\n        } else if (!audioTrack || audioTrack.readyState !== 'live' || !audioTrack.enabled || audioTrack.muted) {\r\n           issue = \"Microphone is off or blocked\";\r\n        }\r\n      }\r\n\r\n      // Check 2: Video Signal Analysis (Black Screen Detection)\r\n      if (!issue && videoEl && videoEl.readyState === 4) { // 4 = HAVE_ENOUGH_DATA\r\n         try {\r\n           const canvas = canvasRef.current;\r\n           const ctx = canvas.getContext('2d', { willReadFrequently: true });\r\n           canvas.width = 100; // Low res for performance\r\n           canvas.height = 100;\r\n           \r\n           ctx.drawImage(videoEl, 0, 0, 100, 100);\r\n           const frame = ctx.getImageData(0, 0, 100, 100);\r\n           const data = frame.data;\r\n           \r\n           let totalBrightness = 0;\r\n           for (let i = 0; i < data.length; i += 4) {\r\n             // Calculate brightness: (R + G + B) / 3\r\n             totalBrightness += (data[i] + data[i + 1] + data[i + 2]) / 3;\r\n           }\r\n           \r\n           const avgBrightness = totalBrightness / (data.length / 4);\r\n           \r\n           // Threshold for \"black screen\". \r\n           // Completely black is 0. A covered camera usually produces noise < 10-15.\r\n           if (avgBrightness < 15) { \r\n             issue = \"Person not detected or camera is blank. Please adjust the camera properly\";\r\n           }\r\n         } catch (e) {\r\n           console.error(\"Video analysis error:\", e);\r\n         }\r\n      }\r\n\r\n      if (issue) {\r\n         setDeviceViolations(prev => {\r\n            const newCount = prev + 1;\r\n            addLog(\"device_violation\", `${issue}. Count: ${newCount}`);\r\n            \r\n            // \"after 2 warnings submit\" -> 3rd strike submits\r\n             if (newCount > 2) { \r\n                // Prevent multiple submits if already submitting\r\n                if (newCount === 3) {\r\n                  toast.error(\"Max violations reached. Auto-submitting...\");\r\n                  if (finalSubmitRef.current) {\r\n                    finalSubmitRef.current();\r\n                  }\r\n                }\r\n             } else {\r\n               toast.error(`${issue}! Warning ${newCount}/2`, {\r\n                 duration: 4000, // Show longer\r\n                 icon: '‚ö†Ô∏è',\r\n               });\r\n            }\r\n            return newCount;\r\n         });\r\n      }\r\n    }, 5000); // Check every 5 seconds\r\n\r\n    return () => clearInterval(interval);\r\n  }, [exam]);\r\n\r\n  // 4. TAB SWITCH\r\n  useEffect(() => {\r\n      if (!exam?.proctoring?.tabSwitch) return;\r\n\r\n      const handleVisibilityChange = () => {\r\n        if (document.hidden) {\r\n          const newCount = tabSwitches + 1;\r\n          setTabSwitches(newCount);\r\n          addLog(\"tab_switch\", `Tab switched. Violation ${newCount}`);\r\n          \r\n          const limit = exam.proctoring.tabSwitchLimit || 3;\r\n          if (newCount >= limit) {\r\n             toast.error(\"Max violations reached. Submitting...\");\r\n             if (finalSubmitRef.current) {\r\n               finalSubmitRef.current();\r\n             }\r\n          } else {\r\n             toast.error(`Warning: Tab switch detected! (${newCount}/${limit})`);\r\n          }\r\n        }\r\n      };\r\n\r\n      document.addEventListener(\"visibilitychange\", handleVisibilityChange);\r\n      return () => document.removeEventListener(\"visibilitychange\", handleVisibilityChange);\r\n  }, [exam, tabSwitches]);\r\n\r\n  // 4. COPY-PASTE BLOCK\r\n  useEffect(() => {\r\n      const handlePrevent = (e) => {\r\n          e.preventDefault();\r\n          toast.error(\"Action not allowed!\");\r\n          addLog(\"copy_paste\", \"Attempted copy/paste/contextmenu\");\r\n      };\r\n\r\n      document.addEventListener(\"contextmenu\", handlePrevent);\r\n      document.addEventListener(\"copy\", handlePrevent);\r\n      document.addEventListener(\"paste\", handlePrevent);\r\n      document.addEventListener(\"cut\", handlePrevent);\r\n\r\n      return () => {\r\n          document.removeEventListener(\"contextmenu\", handlePrevent);\r\n          document.removeEventListener(\"copy\", handlePrevent);\r\n          document.removeEventListener(\"paste\", handlePrevent);\r\n          document.removeEventListener(\"cut\", handlePrevent);\r\n      };\r\n  }, []);\r\n\r\n  /* ================= AUTO SAVE ANSWERS ================= */\r\n  const triggerAutoSave = async () => {\r\n    try {\r\n      await autoSave({\r\n        examId,\r\n        answers: Object.entries(answers).map(([index, data]) => {\r\n          const q = questions[index];\r\n          if (q.type === \"coding\") {\r\n            return {\r\n              questionId: q._id,\r\n              code: data.code,\r\n              language: data.language,\r\n              isCorrect: data.isCorrect,\r\n              testCases: data.testCases,\r\n            };\r\n          }\r\n          return {\r\n            questionId: q._id,\r\n            selectedOption: data,\r\n          };\r\n        }),\r\n        markedForReview: Array.from(marked).map((idx) => questions[idx]._id),\r\n        activityLogs: logsRef.current,\r\n      });\r\n    } catch (err) {\r\n      console.error(\"Auto-save failed\", err);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (questions.length === 0) return;\r\n\r\n    const interval = setInterval(() => {\r\n      // Always auto-save to ensure session heartbeat and timer sync\r\n      triggerAutoSave();\r\n    }, 5000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, [answers, questions, examId, marked]);\r\n\r\n  /* ================= HANDLE ACTIONS ================= */\r\n  const handleSelect = (optionIndex) => {\r\n    setAnswers((prev) => ({\r\n      ...prev,\r\n      [current]: optionIndex,\r\n    }));\r\n  };\r\n\r\n  const toggleMark = () => {\r\n    setMarked(prev => {\r\n      const newSet = new Set(prev);\r\n      if (newSet.has(current)) newSet.delete(current);\r\n      else newSet.add(current);\r\n      return newSet;\r\n    });\r\n  };\r\n\r\n  const handleSaveAndNext = async () => {\r\n    await triggerAutoSave();\r\n    setCurrent((p) => p + 1);\r\n  };\r\n\r\n  /* ================= RECORDING HELPERS ================= */\r\n  const stopRecorder = (recorder, chunksRef) => {\r\n    return new Promise((resolve) => {\r\n      if (!recorder || recorder.state === \"inactive\") {\r\n        resolve(new Blob(chunksRef.current, { type: \"video/webm\" }));\r\n        return;\r\n      }\r\n      recorder.onstop = () => {\r\n        const blob = new Blob(chunksRef.current, { type: \"video/webm\" });\r\n        resolve(blob);\r\n      };\r\n      recorder.stop();\r\n    });\r\n  };\r\n\r\n  const uploadRecordings = async () => {\r\n    try {\r\n      const formData = new FormData();\r\n      formData.append(\"examId\", examId);\r\n\r\n      // Stop & Collect Webcam\r\n      if (webcamRecorderRef.current) {\r\n        const webcamBlob = await stopRecorder(webcamRecorderRef.current, webcamChunksRef);\r\n        if (webcamBlob.size > 0) {\r\n          formData.append(\"webcam\", webcamBlob, \"webcam.webm\");\r\n        }\r\n      }\r\n\r\n      // Stop & Collect Screen\r\n      if (screenRecorderRef.current) {\r\n        const screenBlob = await stopRecorder(screenRecorderRef.current, screenChunksRef);\r\n        if (screenBlob.size > 0) {\r\n           formData.append(\"screen\", screenBlob, \"screen.webm\");\r\n        }\r\n      }\r\n      \r\n      if (formData.has(\"webcam\") || formData.has(\"screen\")) {\r\n          const toastId = toast.loading(\"Uploading exam recordings...\");\r\n          await axios.post(\"/results/upload-recording\", formData, {\r\n            headers: { \"Content-Type\": \"multipart/form-data\" },\r\n          });\r\n          toast.dismiss(toastId);\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error(\"Upload error:\", error);\r\n      // Don't block submission on upload fail, but warn\r\n      toast.error(\"Recording upload failed.\");\r\n    }\r\n  };\r\n\r\n  /* ================= FINAL SUBMIT ================= */\r\n  const finalSubmit = async (submissionType = \"manual\") => {\r\n    try {\r\n      if (submissionType === \"auto\") {\r\n        setIsAutoSubmitting(true);\r\n        toast.loading(\"Time's up! Auto-submitting your exam...\", { id: \"auto-submit\" });\r\n      }\r\n\r\n      // 1. Prioritize Answer Submission (Submit answers first)\r\n      await submitExam({\r\n        examId,\r\n        submissionType,\r\n        answers: Object.entries(answers).map(([index, data]) => {\r\n          const q = questions[index];\r\n          if (q.type === \"coding\") {\r\n            return {\r\n              questionId: q._id,\r\n              code: data.code,\r\n              language: data.language,\r\n              isCorrect: data.isCorrect,\r\n            };\r\n          }\r\n          return {\r\n            questionId: q._id,\r\n            selectedOption: data,\r\n          };\r\n        }),\r\n        activityLogs: logsRef.current,\r\n      });\r\n\r\n      // 2. Upload Recordings (in background if possible, or wait)\r\n      try {\r\n        await uploadRecordings();\r\n      } catch (recErr) {\r\n        console.error(\"Recording upload failed\", recErr);\r\n        // Don't block exam submission for recording failure\r\n      }\r\n\r\n      // 3. Stop Camera/Mic/Screen\r\n      stopMediaStream();\r\n      \r\n      // Exit Fullscreen\r\n      if (document.fullscreenElement) {\r\n        document.exitFullscreen().catch(err => console.error(err));\r\n      }\r\n\r\n      if (submissionType === \"auto\") {\r\n        toast.success(\"Exam auto-submitted successfully\", { id: \"auto-submit\" });\r\n      } else {\r\n        toast.success(\"Exam submitted successfully\");\r\n      }\r\n      \r\n      navigate(`/student/result/${examId}`);\r\n    } catch (error) {\r\n      console.error(error);\r\n      if (submissionType === \"auto\") {\r\n        toast.error(\"Auto-submit failed. Please click submit manually if possible.\", { id: \"auto-submit\" });\r\n        setIsAutoSubmitting(false);\r\n      } else {\r\n        toast.error(\"Failed to submit exam\");\r\n      }\r\n    }\r\n  };\r\n\r\n  // Keep finalSubmitRef updated\r\n  useEffect(() => {\r\n    finalSubmitRef.current = finalSubmit;\r\n  });\r\n\r\n  /* ================= AUTO SUBMIT ON TIME UP ================= */\r\n  const handleTimeUp = () => {\r\n    finalSubmit(\"auto\");\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center\">\r\n        Loading exam...\r\n      </div>\r\n    );\r\n  }\r\n\r\n\r\n  /* ================= UI ================= */\r\n  const enterFullScreen = () => {\r\n      document.documentElement.requestFullscreen().catch(console.error);\r\n  };\r\n\r\n  const enableScreenShare = async () => {\r\n      try {\r\n          const screenStream = await navigator.mediaDevices.getDisplayMedia({ \r\n              video: { cursor: \"always\" }, \r\n              audio: true \r\n          });\r\n\r\n          // Check if system audio track exists\r\n          const systemAudioTrack = screenStream.getAudioTracks()[0];\r\n          \r\n          if (!systemAudioTrack) {\r\n              // Stop the video track if audio wasn't shared\r\n              screenStream.getTracks().forEach(track => track.stop());\r\n              toast.error(\"Without audio you can't share the screen. Please turn on the 'Also share system audio' option!\");\r\n              return;\r\n          }\r\n\r\n          let finalStream = screenStream;\r\n          const audioTracks = [];\r\n\r\n          // 1. Get System Audio (already confirmed exists)\r\n          audioTracks.push(systemAudioTrack);\r\n\r\n          // 2. Get Mic Audio (from webcam stream)\r\n          if (mediaStreamRef.current) {\r\n             const micTrack = mediaStreamRef.current.getAudioTracks()[0];\r\n             if (micTrack) {\r\n                audioTracks.push(micTrack);\r\n             }\r\n          }\r\n\r\n          // 3. Mix Audio if multiple sources exist\r\n          if (audioTracks.length > 0) {\r\n              const audioContext = new (window.AudioContext || window.webkitAudioContext)();\r\n              audioContextRef.current = audioContext; // Store ref\r\n              const destination = audioContext.createMediaStreamDestination();\r\n\r\n              if (systemAudioTrack) {\r\n                  const systemSource = audioContext.createMediaStreamSource(new MediaStream([systemAudioTrack]));\r\n                  systemSource.connect(destination);\r\n              }\r\n\r\n              if (audioTracks.length > 1 || (audioTracks.length === 1 && !systemAudioTrack)) {\r\n                   // If we have mic track (either alone or with system)\r\n                   const micTrack = audioTracks.find(t => t !== systemAudioTrack);\r\n                   if (micTrack) {\r\n                       const micSource = audioContext.createMediaStreamSource(new MediaStream([micTrack]));\r\n                       micSource.connect(destination);\r\n                   }\r\n              }\r\n\r\n              const mixedAudioTrack = destination.stream.getAudioTracks()[0];\r\n              finalStream = new MediaStream([\r\n                  screenStream.getVideoTracks()[0], \r\n                  mixedAudioTrack\r\n              ]);\r\n          }\r\n\r\n          // Ensure we stop ALL tracks (Original System Audio + Mixed Audio + Video)\r\n          // We create a \"master\" stream for cleanup purposes that contains all tracks we touched\r\n          const tracksToCleanup = [...finalStream.getTracks()];\r\n          if (systemAudioTrack && !tracksToCleanup.includes(systemAudioTrack)) {\r\n             tracksToCleanup.push(systemAudioTrack);\r\n          }\r\n          \r\n          screenStreamRef.current = new MediaStream(tracksToCleanup);\r\n          setHasScreenShare(true);\r\n          \r\n          const mimeTypes = [\r\n              \"video/webm;codecs=vp9,opus\",\r\n              \"video/webm;codecs=vp8,opus\",\r\n              \"video/webm\"\r\n          ];\r\n          const selectedMimeType = mimeTypes.find(type => MediaRecorder.isTypeSupported(type));\r\n\r\n          if (selectedMimeType) {\r\n             const recorder = new MediaRecorder(finalStream, { \r\n                 mimeType: selectedMimeType,\r\n                 audioBitsPerSecond: 128000,\r\n                 videoBitsPerSecond: 2500000\r\n             });\r\n             recorder.ondataavailable = (e) => {\r\n                if (e.data.size > 0) screenChunksRef.current.push(e.data);\r\n             };\r\n             recorder.start(1000);\r\n             screenRecorderRef.current = recorder;\r\n          }\r\n          \r\n          // Listen for stop on the original screen stream video track\r\n          screenStream.getVideoTracks()[0].onended = () => {\r\n              toast.error(\"Screen sharing stopped! Exam will be submitted.\");\r\n              if (finalSubmitRef.current) finalSubmitRef.current();\r\n          };\r\n      } catch (err) {\r\n          console.error(err);\r\n          toast.error(\"Screen sharing is required!\");\r\n      }\r\n  };\r\n\r\n  if (exam?.proctoring?.screenRecording && !hasScreenShare) {\r\n      return (\r\n          <div className=\"fixed inset-0 bg-gray-900 flex flex-col items-center justify-center z-50 text-white\">\r\n              <h2 className=\"text-2xl font-bold mb-4\">Screen Share Required</h2>\r\n              <p className=\"mb-6\">This exam requires screen recording. Please enable screen sharing to proceed.</p>\r\n              <button \r\n                  onClick={enableScreenShare}\r\n                  className=\"px-6 py-3 bg-blue-600 rounded font-bold hover:bg-blue-700\"\r\n              >\r\n                  Enable Screen Share\r\n              </button>\r\n          </div>\r\n      );\r\n  }\r\n\r\n  if (exam?.proctoring?.fullScreen && !isFullScreen) {\r\n      return (\r\n          <div className=\"fixed inset-0 bg-gray-900 flex flex-col items-center justify-center z-50 text-white\">\r\n              <h2 className=\"text-2xl font-bold mb-4\">Fullscreen Required</h2>\r\n              <p className=\"mb-6\">You must be in fullscreen mode to take this exam.</p>\r\n              <button \r\n                  onClick={enterFullScreen}\r\n                  className=\"px-6 py-3 bg-blue-600 rounded font-bold hover:bg-blue-700\"\r\n              >\r\n                  Enter Fullscreen\r\n              </button>\r\n          </div>\r\n      );\r\n  }\r\n\r\n  return (\r\n    <div className={`h-screen bg-gray-50 flex flex-col touch-manipulation ${isFullScreen ? \"fullscreen-mode\" : \"\"}`}>\r\n      {/* Header */}\r\n      <header className={`h-16 bg-white border-b border-gray-200 flex items-center justify-between px-6 z-50 shadow-sm flex-shrink-0`}>\r\n        <div className=\"flex items-center gap-4\">\r\n          <h1 className=\"font-bold text-xl text-gray-800 tracking-tight\">Online Examination</h1>\r\n          {exam && (\r\n            <span className=\"px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-xs font-bold uppercase border border-blue-100\">\r\n              {exam.title}\r\n            </span>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"flex items-center gap-6\">\r\n          {initialSeconds !== null ? (\r\n            <div className=\"flex items-center gap-3\">\r\n              <span className=\"text-[10px] font-black text-gray-400 uppercase tracking-widest hidden md:block\">Time Remaining</span>\r\n              <Timer\r\n                initialSeconds={initialSeconds}\r\n                onTimeUp={handleTimeUp}\r\n              />\r\n            </div>\r\n          ) : (\r\n            <div className=\"text-gray-400 text-sm italic\">Initializing timer...</div>\r\n          )}\r\n            <div className=\"flex items-center space-x-4\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => {\r\n                  if (isFullScreen) {\r\n                    document.exitFullscreen();\r\n                  } else {\r\n                    document.documentElement.requestFullscreen().catch(console.error);\r\n                  }\r\n                }}\r\n                className=\"text-gray-600 hover:text-gray-900\"\r\n                title={isFullScreen ? \"Exit Fullscreen\" : \"Enter Fullscreen\"}\r\n              >\r\n                {isFullScreen ? <Minimize2 size={20} /> : <Maximize2 size={20} />}\r\n              </button>\r\n            </div>\r\n        </div>\r\n      </header>\r\n\r\n      {/* Auto-Submit Overlay */}\r\n      {isAutoSubmitting && (\r\n        <div className=\"fixed inset-0 bg-black/80 flex flex-col items-center justify-center z-[100] backdrop-blur-sm\">\r\n          <div className=\"bg-[#1e1e1e] p-8 rounded-2xl border border-blue-500/30 flex flex-col items-center max-w-sm text-center shadow-2xl animate-in zoom-in duration-300\">\r\n            <div className=\"w-16 h-16 border-4 border-blue-500/20 border-t-blue-500 rounded-full animate-spin mb-6\"></div>\r\n            <h2 className=\"text-2xl font-bold text-white mb-2\">Time is Up!</h2>\r\n            <p className=\"text-gray-400 mb-4\">Your exam is being automatically submitted. Please do not close this window.</p>\r\n            <div className=\"px-4 py-2 bg-blue-500/10 text-blue-400 rounded-lg text-sm font-medium border border-blue-500/20\">\r\n              Saving your answers...\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Main Content */}\r\n      <main className={`flex-1 flex overflow-hidden relative`}>\r\n        {/* Left Side: Question Area (Scrollable) */}\r\n        <div className={`flex-1 flex flex-col bg-white overflow-hidden ${isFullScreen ? (questions[current]?.type === \"coding\" ? \"w-1/2 border-r border-gray-200\" : \"w-full\") : \"w-1/3 border-r border-gray-200\"}`}>\r\n          <div className=\"flex-1 overflow-y-auto p-6 custom-scrollbar\">\r\n            {questions[current] && (\r\n              <div className={`space-y-6 animate-in fade-in slide-in-from-left-4 duration-500 ${isFullScreen && questions[current]?.type !== \"coding\" ? \"max-w-4xl mx-auto pt-8\" : \"\"}`}>\r\n                <div className=\"flex justify-between items-start\">\r\n                  <h2 className=\"text-2xl font-black text-gray-900 flex items-center gap-3\">\r\n                    <span className=\"flex items-center justify-center w-10 h-10 bg-blue-600 text-white rounded-lg shadow-blue-200 shadow-lg\">\r\n                      {current + 1}\r\n                    </span>\r\n                    Question\r\n                  </h2>\r\n                  <button\r\n                    onClick={toggleMark}\r\n                    className={`p-2 rounded-lg transition-all ${\r\n                      marked.has(current) \r\n                        ? 'bg-purple-100 text-purple-600 border border-purple-200' \r\n                        : 'bg-gray-100 text-gray-400 border border-gray-200 hover:text-yellow-600 hover:bg-yellow-50 hover:border-yellow-200'\r\n                    }`}\r\n                    title={marked.has(current) ? \"Unmark for review\" : \"Mark for review\"}\r\n                  >\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill={marked.has(current) ? \"currentColor\" : \"none\"} stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><path d=\"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z\"></path></svg>\r\n                  </button>\r\n                </div>\r\n\r\n                <div className=\"prose prose-blue max-w-none\">\r\n                  {questions[current].type === \"coding\" ? (\r\n                    <div className=\"bg-gray-50 p-5 rounded-xl border border-gray-100 text-gray-800 leading-relaxed font-medium whitespace-pre-wrap\">\r\n                      {questions[current].question}\r\n                    </div>\r\n                  ) : (\r\n                    <QuestionCard\r\n                      question={questions[current]}\r\n                      selectedOption={answers[current]}\r\n                      onSelect={handleSelect}\r\n                    />\r\n                  )}\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <div className={`p-4 bg-white border-t border-gray-200 ${isFullScreen && questions[current]?.type !== \"coding\" ? \"fixed bottom-0 left-0 right-0 z-50 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]\" : \"\"}`}>\r\n            <div className={`${isFullScreen && questions[current]?.type !== \"coding\" ? \"max-w-7xl mx-auto flex items-start gap-8\" : \"\"}`}>\r\n               \r\n               <div className=\"flex-1\">\r\n                  <h3 className=\"text-xs font-bold text-gray-400 uppercase tracking-widest mb-3 flex items-center gap-2\">\r\n                    <span className=\"w-1.5 h-1.5 bg-gray-400 rounded-full\"></span> Question Navigator\r\n                  </h3>\r\n                  <QuestionPalette\r\n                    total={questions.length}\r\n                    answers={answers}\r\n                    current={current}\r\n                    onSelect={setCurrent}\r\n                    marked={marked}\r\n                  />\r\n                  {/* Legend */}\r\n                  <div className=\"mt-3 flex flex-wrap gap-x-4 gap-y-2 text-[10px] font-bold uppercase tracking-wider text-gray-500\">\r\n                    <div className=\"flex items-center gap-1.5\"><span className=\"w-2.5 h-2.5 bg-green-500 rounded-sm border border-green-600\"></span> Answered</div>\r\n                    <div className=\"flex items-center gap-1.5\"><span className=\"w-2.5 h-2.5 bg-purple-600 rounded-sm border border-purple-700\"></span> Marked</div>\r\n                    <div className=\"flex items-center gap-1.5\"><span className=\"w-2.5 h-2.5 bg-blue-600 rounded-sm border border-blue-700\"></span> Current</div>\r\n                    <div className=\"flex items-center gap-1.5\"><span className=\"w-2.5 h-2.5 bg-gray-100 border border-gray-300 rounded-sm\"></span> Unvisited</div>\r\n                  </div>\r\n               </div>\r\n\r\n               {/* Navigation Buttons (Moved here for better layout in fullscreen) */}\r\n               {isFullScreen && questions[current]?.type === \"mcq\" && (\r\n                  <div className=\"flex items-center gap-3 self-center border-l border-gray-100 pl-8\">\r\n                    <button\r\n                      disabled={current === 0}\r\n                      onClick={() => setCurrent((p) => p - 1)}\r\n                      className=\"flex items-center gap-2 px-5 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold rounded-lg transition-all disabled:opacity-50 text-sm\"\r\n                    >\r\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><line x1=\"19\" y1=\"12\" x2=\"5\" y2=\"12\"></line><polyline points=\"12 19 5 12 12 5\"></polyline></svg>\r\n                      Prev\r\n                    </button>\r\n\r\n                    <button\r\n                      onClick={handleSaveAndNext}\r\n                      disabled={current === questions.length - 1}\r\n                      className=\"flex items-center gap-2 px-6 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg transition-all shadow-sm hover:shadow-md active:scale-95 disabled:opacity-50 text-sm\"\r\n                    >\r\n                      Save & Next\r\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"></line><polyline points=\"12 5 19 12 12 19\"></polyline></svg>\r\n                    </button>\r\n                    \r\n                    <button\r\n                      onClick={() => setShowSubmit(true)}\r\n                      className=\"bg-red-600 hover:bg-red-700 text-white px-6 py-2.5 rounded-lg font-bold transition-all shadow-sm hover:shadow-md active:scale-95 text-sm ml-2\"\r\n                    >\r\n                      Submit\r\n                    </button>\r\n                  </div>\r\n               )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Right Side: Editor/Content Area */}\r\n        <div className={`flex-1 flex flex-col bg-[#1e1e1e] overflow-hidden\r\n          ${isFullScreen && questions[current]?.type === \"mcq\" ? \"hidden\" : \"\"}\r\n          ${isFullScreen && questions[current]?.type === \"coding\" ? \"w-1/2\" : \"\"}`}>\r\n          {questions[current]?.type === \"coding\" ? (\r\n            <div className=\"flex-1 flex flex-col\">\r\n              <CodingEnvironment\r\n                question={questions[current]}\r\n                initialData={answers[current]}\r\n                onSave={handleSelect}\r\n                layout=\"split-vertical\" // We'll handle layout inside CodingEnvironment or by CSS\r\n              />\r\n            </div>\r\n          ) : (\r\n  <div className=\"flex-1 p-6 overflow-y-auto\">\r\n    <QuestionCard\r\n      question={questions[current]}\r\n      selectedOption={answers[current]}\r\n      onSelect={handleSelect}\r\n    />\r\n  </div>\r\n)}\r\n\r\n          {/* Navigation Controls (Bottom Right) */}\r\n          <div className=\"bg-white border-t border-gray-200 px-6 py-4 flex justify-between items-center z-20 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]\">\r\n            <button\r\n              disabled={current === 0}\r\n              onClick={() => setCurrent((p) => p - 1)}\r\n              className=\"flex items-center gap-2 px-5 py-2.5 text-gray-700 font-bold hover:bg-gray-100 rounded-lg transition-all disabled:opacity-30 disabled:hover:bg-transparent\"\r\n            >\r\n              <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><line x1=\"19\" y1=\"12\" x2=\"5\" y2=\"12\"></line><polyline points=\"12 19 5 12 12 5\"></polyline></svg>\r\n              Previous\r\n            </button>\r\n\r\n            <button\r\n              onClick={handleSaveAndNext}\r\n              disabled={current === questions.length - 1}\r\n              className=\"flex items-center gap-2 px-8 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg transition-all shadow-md hover:shadow-lg active:scale-95 disabled:opacity-30\"\r\n            >\r\n              Save & Next\r\n              <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\"></line><polyline points=\"12 5 19 12 12 19\"></polyline></svg>\r\n            </button>\r\n            <button\r\n              onClick={() => setShowSubmit(true)}\r\n              className=\"bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg font-bold transition-all shadow-md hover:shadow-lg active:scale-95\"\r\n            >\r\n              Submit Exam\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* WEBCAM FEED - Overlayed Floating */}\r\n        {exam?.proctoring?.webcam && (\r\n          <div \r\n            className={`fixed bottom-24 right-6 w-48 h-36 bg-black border-2 border-white shadow-2xl rounded-xl overflow-hidden group transition-all duration-300 hover:w-64 hover:h-48 ${isFullScreen ? \"z-[60]\" : \"z-50\"}`}\r\n            style={{ \r\n              transform: `translate(${cameraPos.x}px, ${cameraPos.y}px)`,\r\n              cursor: isDraggingRef.current ? \"grabbing\" : \"default\" \r\n            }}\r\n          >\r\n            <video \r\n              ref={videoRef} \r\n              autoPlay \r\n              muted \r\n              className=\"w-full h-full object-cover transition-transform group-hover:scale-105\"\r\n            />\r\n            \r\n            {/* Header / Drag Handle */}\r\n            <div className=\"absolute top-0 left-0 right-0 p-2 flex items-center justify-between z-10 pointer-events-none\">\r\n                <div className=\"flex items-center gap-1.5 bg-black/50 px-2 py-0.5 rounded-full backdrop-blur-sm\">\r\n                  <span className=\"w-2 h-2 bg-red-500 rounded-full animate-pulse shadow-[0_0_8px_rgba(239,68,68,0.8)]\"></span>\r\n                  <span className=\"text-[10px] font-bold text-white uppercase tracking-wider drop-shadow-md\">Live Feed</span>\r\n                </div>\r\n                \r\n                {/* Drag Button */}\r\n                <div \r\n                  onMouseDown={handleDragStart}\r\n                  className=\"bg-black/50 p-1.5 rounded-full backdrop-blur-sm cursor-move hover:bg-blue-600 transition-colors pointer-events-auto shadow-sm border border-white/10\"\r\n                  title=\"Drag to move camera\"\r\n                >\r\n                  <Move size={14} className=\"text-white\" />\r\n                </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </main>\r\n\r\n      {/* Submit Confirmation Modal */}\r\n      <SubmitModal\r\n        open={showSubmit}\r\n        onClose={() => setShowSubmit(false)}\r\n        attempted={Object.keys(answers).length}\r\n        total={questions.length}\r\n        onConfirm={finalSubmit}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Exam;\r\n","usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\pages\\student\\Leaderboard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\pages\\student\\Result.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\pages\\student\\StudentDashboard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\pages\\trainer\\AddQuestions.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchQuestions'. Either include it or remove the dependency array.","line":59,"column":6,"nodeType":"ArrayExpression","endLine":59,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [examId, exams, fetchQuestions]","fix":{"range":[1869,1884],"text":"[examId, exams, fetchQuestions]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState, useRef } from \"react\";\nimport toast from \"react-hot-toast\";\nimport { Folder, ArrowLeft, Download } from \"lucide-react\";\nimport jsPDF from \"jspdf\";\nimport autoTable from \"jspdf-autotable\";\n\nimport AdminSidebar from \"../../components/AdminSidebar\";\nimport AdminHeader from \"../../components/AdminHeader\";\nimport { getExams, getAdminQuestions, updateQuestion, deleteQuestion } from \"../../api/examApi\";\nimport axios from \"../../api/axiosInstance\";\n\nconst AddQuestions = () => {\n  const [exams, setExams] = useState([]);\n  const [examId, setExamId] = useState(\"\");\n  const [questionsList, setQuestionsList] = useState([]);\n  const [editingId, setEditingId] = useState(null);\n\n  const [question, setQuestion] = useState(\"\");\n  const [options, setOptions] = useState([\"\", \"\", \"\", \"\"]);\n  const [correctOption, setCorrectOption] = useState(null);\n  const [isPublished, setIsPublished] = useState(false);\n\n  // Undo history for smart paste\n  const undoRef = useRef(null);\n  const isSmartPasting = useRef(false);\n\n  useEffect(() => {\n    getExams().then((res) => setExams(res.data));\n  }, []);\n\n  async function fetchQuestions() {\n    try {\n      const res = await getAdminQuestions(examId);\n      setQuestionsList(res.data);\n    } catch (error) {\n      console.error(\"Failed to fetch questions\", error);\n    }\n  }\n\n  useEffect(() => {\n    const timeoutId = setTimeout(() => {\n      if (examId) {\n        const selectedExam = exams.find((e) => e._id === examId);\n        const published = Boolean(selectedExam?.isPublished);\n\n        setIsPublished(published);\n        if (published) {\n          toast.error(\"Your exam is already published, unable to add questions\");\n        }\n\n        fetchQuestions();\n      } else {\n        setQuestionsList([]);\n        setIsPublished(false);\n      }\n    }, 0);\n\n    return () => clearTimeout(timeoutId);\n  }, [examId, exams]);\n\n  const handleOptionChange = (value, index) => {\n    // Clear undo history if user manually edits options\n    undoRef.current = null;\n    const updated = [...options];\n    updated[index] = value;\n    setOptions(updated);\n  };\n\n  const handleEdit = (q) => {\n    if (isPublished) {\n      toast.error(\"Your exam is already published, unable to edit questions\");\n      return;\n    }\n    setEditingId(q._id);\n    setQuestion(q.question);\n    setOptions(q.options);\n    setCorrectOption(q.correctOption);\n    window.scrollTo(0, 0);\n  };\n\n  const handleCancelEdit = () => {\n    setEditingId(null);\n    setQuestion(\"\");\n    setOptions([\"\", \"\", \"\", \"\"]);\n    setCorrectOption(null);\n  };\n\n  const handleDelete = async (id) => {\n    if (isPublished) {\n      toast.error(\"Your exam is already published, unable to delete questions\");\n      return;\n    }\n    if (!window.confirm(\"Are you sure you want to delete this question?\")) return;\n    try {\n      await deleteQuestion(id);\n      toast.success(\"Question deleted\");\n      fetchQuestions();\n    } catch {\n      toast.error(\"Failed to delete question\");\n    }\n  };\n\n  const handleDownloadQuestions = () => {\n    if (questionsList.length === 0) {\n      toast.error(\"No questions to download\");\n      return;\n    }\n\n    const examTitle = exams.find(e => e._id === examId)?.title || \"Exam\";\n    const doc = new jsPDF();\n\n    // Add Title\n    doc.setFontSize(18);\n    doc.text(`${examTitle} - Questions`, 14, 22);\n\n    // Prepare Table Data\n    const tableData = questionsList.map((q, index) => [\n      index + 1,\n      q.question,\n      q.options[0],\n      q.options[1],\n      q.options[2],\n      q.options[3],\n      q.options[q.correctOption] // Correct Answer Text\n    ]);\n\n    // Generate Table\n    autoTable(doc, {\n      startY: 30,\n      head: [[\"#\", \"Question\", \"Option A\", \"Option B\", \"Option C\", \"Option D\", \"Correct\"]],\n      body: tableData,\n      theme: \"grid\",\n      headStyles: { fillColor: [41, 128, 185] }, // Blue header\n      styles: { fontSize: 10, cellPadding: 3 },\n      columnStyles: {\n        0: { cellWidth: 10 }, // #\n        1: { cellWidth: 50 }, // Question\n        2: { cellWidth: 25 }, // Opt A\n        3: { cellWidth: 25 }, // Opt B\n        4: { cellWidth: 25 }, // Opt C\n        5: { cellWidth: 25 }, // Opt D\n        6: { cellWidth: 25 }, // Correct\n      },\n    });\n\n    doc.save(`${examTitle}_Questions.pdf`);\n  };\n\n  const handlePaste = (e) => {\n    const pastedData = e.clipboardData.getData(\"text\");\n    if (!pastedData) return;\n\n    const lines = pastedData.split(/\\r?\\n/).map(line => line.trim()).filter(line => line.length > 0);\n\n    if (lines.length >= 5) {\n      const last4 = lines.slice(-4);\n      const optionRegex = /^([A-Da-d1-4])[.)-]\\s+(.*)$/;\n      \n      const cleanedOptions = last4.map(opt => {\n        const match = opt.match(optionRegex);\n        return match ? match[2] : opt;\n      });\n\n      e.preventDefault();\n      \n      // Save current state for undo\n      undoRef.current = {\n        question: question, // Current question text before paste\n        options: [...options] // Current options before paste\n      };\n      \n      isSmartPasting.current = true;\n\n      const questionBody = lines.slice(0, lines.length - 4).join(\"\\n\");\n      \n      // Use execCommand to preserve browser undo history for the text field\n      setOptions(cleanedOptions);\n\n      // Select all text in the textarea to ensure we replace content like a normal paste/set\n      e.target.select();\n      document.execCommand('insertText', false, questionBody);\n      \n      toast.success(\"Question and options auto-populated!\");\n    }\n  };\n\n  const handleKeyDown = (e) => {\n    // Custom Undo for Smart Paste (Ctrl+Z)\n    if ((e.ctrlKey || e.metaKey) && e.key === 'z') {\n      if (undoRef.current) {\n        e.preventDefault(); // Prevent native undo since we are handling it manually\n        \n        setQuestion(undoRef.current.question);\n        setOptions(undoRef.current.options);\n        \n        undoRef.current = null; // Clear undo history after using it\n        toast.success(\"Undid smart paste\");\n      }\n    }\n  };\n\n  const handleQuestionChange = (e) => {\n    setQuestion(e.target.value);\n    \n    // If this change was triggered by our smart paste, reset the flag but keep undo history\n    if (isSmartPasting.current) {\n      isSmartPasting.current = false;\n    } else {\n      // If user manually types/changes text, clear the smart paste undo history\n      undoRef.current = null;\n    }\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n\n    if (isPublished) {\n      toast.error(\"Your exam is already published, unable to add questions\");\n      return;\n    }\n\n    if (!examId || correctOption === null) {\n      toast.error(\"Please complete all fields\");\n      return;\n    }\n\n    try {\n      if (editingId) {\n        await updateQuestion(editingId, {\n          question,\n          options,\n          correctOption,\n        });\n        toast.success(\"Question updated successfully\");\n        setEditingId(null);\n      } else {\n        await axios.post(\"/questions\", {\n          examId,\n          question,\n          options,\n          correctOption,\n        });\n        toast.success(\"Question added successfully\");\n      }\n\n      setQuestion(\"\");\n      setOptions([\"\", \"\", \"\", \"\"]);\n      setCorrectOption(null);\n      fetchQuestions();\n    } catch (error) {\n       toast.error(error.response?.data?.message || \"Failed to save question\");\n    }\n  };\n\n  return (\n    <div className=\"flex\">\n      <AdminSidebar />\n\n      <div className=\"ml-64 w-full min-h-screen bg-gray-100\">\n        <AdminHeader />\n\n        <div className=\"p-6 max-w-5xl mx-auto\">\n          {!examId ? (\n            // Folder View\n            <div>\n              <h2 className=\"text-2xl font-bold mb-6 text-gray-800\">Select Exam Folder</h2>\n              {exams.length === 0 ? (\n                <p className=\"text-gray-500\">No exams found. Please create an exam first.</p>\n              ) : (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                  {exams.map((exam) => (\n                    <div \n                      key={exam._id} \n                      onClick={() => setExamId(exam._id)}\n                      className=\"bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-shadow cursor-pointer flex flex-col items-center justify-center border border-gray-200 group\"\n                    >\n                      <Folder size={64} className=\"text-blue-500 mb-4 group-hover:scale-110 transition-transform\" />\n                      <h3 className=\"text-lg font-semibold text-gray-800 text-center\">{exam.title}</h3>\n                      <p className=\"text-sm text-gray-500 mt-2\">Click to manage questions</p>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n          ) : (\n            // Question Management View\n            <div>\n              <div className=\"flex items-center justify-between mb-6\">\n                <button \n                  onClick={() => setExamId(\"\")}\n                  className=\"flex items-center text-gray-600 hover:text-blue-600 transition-colors\"\n                >\n                  <ArrowLeft size={20} className=\"mr-2\" />\n                  Back to Exams\n                </button>\n                <div className=\"flex items-center gap-4\">\n                  <h2 className=\"text-2xl font-bold text-gray-800\">\n                    {exams.find(e => e._id === examId)?.title} - Questions\n                  </h2>\n                  <button\n                    onClick={handleDownloadQuestions}\n                    className=\"flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors shadow-sm\"\n                    title=\"Download Questions\"\n                  >\n                    <Download size={18} />\n                    Download\n                  </button>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n                {/* Form Section */}\n                <div className=\"lg:col-span-1\">\n                  <div className={`bg-white p-6 rounded-xl shadow sticky top-6 ${isPublished ? \"opacity-75\" : \"\"}`}>\n                    <h3 className=\"text-xl font-bold mb-4 border-b pb-2\">\n                      {editingId ? \"Edit Question\" : \"Add New Question\"}\n                    </h3>\n                    \n                    {isPublished && (\n                      <div className=\"bg-yellow-50 border-l-4 border-yellow-500 text-yellow-700 p-3 mb-4 text-sm\" role=\"alert\">\n                        <p className=\"font-bold\">Exam Published</p>\n                        <p>Questions cannot be modified.</p>\n                      </div>\n                    )}\n\n                    <form onSubmit={handleSubmit} className={`space-y-4 ${isPublished ? \"pointer-events-none\" : \"\"}`}>\n                      {/* Question */}\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">Question Text</label>\n                        <textarea\n                          placeholder=\"Enter your question here... (Paste question + 4 options to auto-fill)\"\n                          className=\"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all\"\n                          rows=\"3\"\n                          value={question}\n                          onChange={handleQuestionChange}\n                          onPaste={handlePaste}\n                          onKeyDown={handleKeyDown}\n                          required\n                        />\n                      </div>\n\n                      {/* Options */}\n                      <div className=\"space-y-3\">\n                        <label className=\"block text-sm font-medium text-gray-700\">Options (Select Correct)</label>\n                        {options.map((opt, index) => (\n                          <div key={index} className=\"flex items-center gap-3\">\n                            <input\n                              type=\"radio\"\n                              name=\"correctOption\"\n                              checked={correctOption === index}\n                              onChange={() => setCorrectOption(index)}\n                              className=\"w-4 h-4 text-blue-600 focus:ring-blue-500 cursor-pointer\"\n                            />\n                            <input\n                              placeholder={`Option ${index + 1}`}\n                              className={`w-full p-2 border rounded-lg outline-none transition-all ${correctOption === index ? \"border-blue-500 ring-1 ring-blue-500 bg-blue-50\" : \"border-gray-300 focus:border-blue-400\"}`}\n                              value={opt}\n                              onChange={(e) => handleOptionChange(e.target.value, index)}\n                              required\n                            />\n                          </div>\n                        ))}\n                      </div>\n\n                      <div className=\"flex gap-2 pt-2\">\n                        <button\n                          type=\"submit\"\n                          className=\"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium shadow-sm\"\n                        >\n                          {editingId ? \"Update\" : \"Add Question\"}\n                        </button>\n\n                        {editingId && (\n                          <button\n                            type=\"button\"\n                            onClick={handleCancelEdit}\n                            className=\"bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors\"\n                          >\n                            Cancel\n                          </button>\n                        )}\n                      </div>\n                    </form>\n                  </div>\n                </div>\n\n                {/* List Section */}\n                <div className=\"lg:col-span-2 space-y-4\">\n                   <div className=\"flex justify-between items-center mb-2\">\n                      <h3 className=\"text-lg font-bold text-gray-700\">\n                        Existing Questions ({questionsList.length})\n                      </h3>\n                   </div>\n                  \n                  {questionsList.length === 0 ? (\n                    <div className=\"bg-white p-8 rounded-xl shadow text-center text-gray-500\">\n                      <p>No questions added yet for this exam.</p>\n                      <p className=\"text-sm mt-1\">Use the form on the left to add one.</p>\n                    </div>\n                  ) : (\n                    questionsList.map((q, i) => (\n                      <div key={q._id} className=\"bg-white p-5 rounded-xl shadow border border-gray-100 hover:shadow-md transition-shadow\">\n                        <div className=\"flex justify-between items-start mb-3\">\n                          <h4 className=\"font-semibold text-lg text-gray-800 pr-4\">\n                            <span className=\"text-blue-600 mr-2\">Q{i + 1}.</span>{q.question}\n                          </h4>\n                          <div className=\"flex gap-2 shrink-0\">\n                            <button\n                              onClick={() => handleEdit(q)}\n                              className=\"text-blue-600 hover:text-blue-800 text-sm font-medium px-2 py-1 rounded hover:bg-blue-50 transition-colors\"\n                              disabled={isPublished}\n                            >\n                              Edit\n                            </button>\n                            <button\n                              onClick={() => handleDelete(q._id)}\n                              className=\"text-red-600 hover:text-red-800 text-sm font-medium px-2 py-1 rounded hover:bg-red-50 transition-colors\"\n                              disabled={isPublished}\n                            >\n                              Delete\n                            </button>\n                          </div>\n                        </div>\n                        <ul className=\"pl-2 space-y-2\">\n                          {q.options.map((opt, idx) => (\n                            <li\n                              key={idx}\n                              className={`flex items-center px-3 py-2 rounded-lg text-sm ${\n                                q.correctOption === idx\n                                  ? \"bg-green-50 text-green-700 border border-green-200 font-medium\"\n                                  : \"bg-gray-50 text-gray-600 border border-transparent\"\n                              }`}\n                            >\n                              <span className={`w-6 h-6 flex items-center justify-center rounded-full mr-3 text-xs ${q.correctOption === idx ? \"bg-green-200 text-green-800\" : \"bg-gray-200 text-gray-600\"}`}>\n                                {String.fromCharCode(65 + idx)}\n                              </span>\n                              {opt}\n                              {q.correctOption === idx && <span className=\"ml-auto text-xs bg-green-200 text-green-800 px-2 py-0.5 rounded-full\">Correct</span>}\n                            </li>\n                          ))}\n                        </ul>\n                      </div>\n                    ))\n                  )}\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default AddQuestions;\n","usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\pages\\trainer\\CreateExam.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\pages\\trainer\\ManageExams.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\pages\\trainer\\Results.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\pages\\trainer\\TrainerDashboard.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\routes\\AppRoutes.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\src\\routes\\ProtectedRoute.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"D:\\Online-Exam-Website\\Frontend\\vite.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]